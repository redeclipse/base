exec "config/tool/tooltexparam.cfg"

tool_tex_cur = -1
tool_tex_variantsrc = -1
tool_tex_replace = -1
tool_tex_autoapply = 0
tool_tex_variant_edit = 0
tool_tex_replace_sel = 0

tool_tex_edit = 0
tool_tex_sync_params = 0

tool_tex_props_disabled = 0

tool_tex_blend_brushes = []

loop brushidx (blendbrush -1) [
    append tool_tex_blend_brushes (getblendbrushname $brushidx)
]

tool_tex_can_focus = [
    = $tool_tex_edit 0
]

// 1:<slot> 2:<force>
tool_focus_tex = [
    if (|| $arg2 (tool_tex_can_focus)) [
        tool_tex_cur = $arg1
        tool_tex_variantsrc = (getvindex $arg1)
    ]
]

tool_action_texpaint = [
    tool_tex_edit = 0
    toolpanel_toggle tool_texpaint right [
        uit_title = "Texture blend painting"
    ]
]

tool_action_texreplace = [
    tool_tex_edit = 0
    toolpanel_toggle tool_texreplace right [
        uit_title = "Replace texture"
    ]
]

tool_action_textures = [
    tool_tex_edit = 0
    toolpanel_toggle tool_textures right [
        uit_title = "Textures"
    ]
]

tool_action_tex_apply = [
    settex $tool_tex_cur
]

tool_action_tex_apply_allfaces = [
    local allfaces_old
    allfaces_old = $allfaces

    allfaces 1
    settex $tool_tex_cur
    allfaces = $allfaces_old
]

tool_action_tex_get = [
    tool_focus_tex (getseltex 1)
    tool_info_show "Selected texture" [
        uivslotview $tool_tex_cur $ui_toolinfo_action_image_size $ui_toolinfo_action_image_size
    ]
]

tool_action_tex_editvariant = [
    if (&& (toolpanel_isopen tool_textures) $tool_tex_edit) [
        tool_tex_param_edit_end 0
        tool_tex_edit = 0
    ] [
        toolpanel_open tool_textures right [
            uit_title = "Textures"
        ]
        tool_tex_edit = 1
        tool_tex_param_edit_begin
    ]
]

tool_action_tex_editcancel = [
    tool_tex_param_edit_end 0
    tool_tex_edit = 0
]

tool_action_tex_editconfirm = [
    tool_tex_param_edit_end 1
    tool_tex_edit = 0
]

tool_action ta_textures [
    short_desc "Texture panel"
    long_desc "Open the texture panel"
    icon "textures/icons/edit/texture"
    category "Textures"
    action [
        tool_action_textures
    ]
]

tool_action ta_tex_apply [
    short_desc "Apply texture"
    long_desc "Apply currenly picked texture"
    icon "textures/icons/attack"
    category "Textures"
    action [
        tool_action_tex_apply
    ]
]

tool_action ta_tex_apply_allfaces [
    short_desc "Apply texture on all faces"
    long_desc "Apply currenly picked texture on all faces"
    icon "textures/icons/attack"
    category "Textures"
    action [
        tool_action_tex_apply_allfaces
    ]
]

tool_action ta_tex_get [
    short_desc "Get texture"
    long_desc "Get texture from current in-world selection"
    icon "textures/icons/arrow"
    category "Textures"
    action [
        tool_action_tex_get
    ]
]

tool_action ta_tex_editvariant [
    short_desc "Toggle texture variant edit"
    long_desc "Toggle editing of texture variant parameters"
    icon "textures/icons/voices"
    category "Textures"
    action [
        tool_action_tex_editvariant
    ]
]

tool_action ta_recalc [
    short_desc "Recalculate world verticies"
    long_desc "Recalculate world vertices, normals and blending"
    icon "textures/icons/editing"
    category "Textures"
    action [
        calclight
    ]
]

tool_action ta_tex_cull [
    short_desc "Cull textures"
    long_desc "Cull unused texture slots and optimize inside faces"
    icon "textures/icons/editing"
    category "Textures"
    action [
        texturecull
    ]
]

tool_action ta_tex_replace [
    short_desc "Replace textures"
    long_desc "Replace texture instances with a different one"
    icon "textures/icons/editing"
    category "Textures"
    action [
        tool_action_texreplace
    ]
]

tool_action ta_tex_paint [
    short_desc "Blendmap paint panel"
    long_desc "Open texture blend painting panel"
    icon "textures/icons/editing"
    category "Textures"
    action [
        tool_action_texpaint
    ]
]

tool_action ta_toggle_blankgeom [
    short_desc "Toggle blank geometry mode"
    long_desc "Toggle blank geometry mode, disabling rendering diffuse textures"
    icon "textures/icons/edit/texture"
    category "Textures"
    action [
        blankgeom (! $blankgeom)
    ]
]
