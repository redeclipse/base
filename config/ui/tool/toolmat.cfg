ui_tool_mat_param_interval = (? (isonline) 250 0)

ui_tool_materials_list = [
    uitext "Material volumes in selection:" $ui_tool_text_size_s
    uialign- -1 -2

    uicolour $ui_tool_dark_colour 0 0 [
        uiclamp 1 1

        uispace $ui_tool_elem_space_s $ui_tool_elem_space_s [
            uiclamp 1 1

            uigrid 4 0 0 [
                uiclamp 1 1
                    if (= $tool_mat_numselmats 0) [
                        uicolourtext "<No materials>" $ui_tool_dark_colour $ui_tool_text_size_xs
                    ]

                    loop i $tool_mat_numselmats [
                        _mat = (at $tool_mat_selmats $i)
                        _matname = (at $tool_mat_selmats_names $i)

                        uitarget 0 0 [
                            uicolourtext $_matname $ui_tool_dark_accent_colour $ui_tool_text_size_xs
                            uiclamp- 1 1

                            uihover [
                                ui_tool_button [
                                    p_label = " X "
                                    p_label_size = $ui_tool_text_size_xs
                                    p_tip_simple = "Remove material"
                                    p_pad = 0
                                    p_on_click = [
                                        editmat air $_mat
                                    ]
                                ]
                                uialign- 1
                            ]
                        ]
                        uiclamp- 1 1
                    ]

                    uiclamp* 1 1
            ]
        ]
    ]
]

# ui_tool_materials_controls [
    uihlist 0 [
        uiclamp 1 1
            #(ui_tool_get_action_button ta_setmat [
                p_label = "Set material"
                p_width = 0.17
                p_height = 0.03
            ])
    ]
]

tool_props_focus_water = 0
tool_props_focus_water_matname = water

tool_props_focus_lava = 0
tool_props_focus_lava_matname = lava

tool_props_focus_volfog = 0
tool_props_focus_volfog_matname = volfog

tool_props_focus_glass = 0
tool_props_focus_glass_matname = glass

// 1:<alt>
# ui_tool_materials_surface_water [
    result [
        uivlist 0 [
            ui_tool_numinput (concatword $tool_props_focus_water_matname fog #1 arg1) 0 0 10 [
                p_label      = [#1(? $arg1 "" "Fog distance")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_val_format = i
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Water fog distance" "thickness" 0)

            uifill 0 $ui_tool_elem_space_s

            ui_tool_colour (concatword $tool_props_focus_water_matname colour #1 arg1) [
                p_label      = #1(? $arg1 "" "Colour")
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_val_format = i
                p_flags      = $TOOL_COLOUR_ZEROFIX
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Water colour" "color" 0)

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput (concatword $tool_props_focus_water_matname refract #1 arg1) 0 0 0.1 [
                p_label      = #1(? $arg1 "" "Refract")
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Water refract" "" 0)

            ui_tool_colour (concatword $tool_props_focus_water_matname refractcolour #1 arg1) [
                p_label      = [#1(? $arg1 "" "Refract colour")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_val_format = i
                p_flags      = $TOOL_COLOUR_ZEROFIX
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Water refract colour" "color" 0)

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput (concatword $tool_props_focus_water_matname spec #1 arg1) 0 0 10 [
                p_label      = #1(? $arg1 "" "Specular")
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_val_format = i
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Water specular" "reflection strength" 0)

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput (concatword $tool_props_focus_water_matname reflectstep #1 arg1) 0 0 16 [
                p_label      = [#1(? $arg1 "" "Reflect ray step")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_val_format = i
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Water reflection ray step" "ssr" 0)

            uiclamp 1 1
            uialign* 1
            uialign 1 -1
        ]
    ]
]

// 1:<alt>
# ui_tool_materials_deep_water [
    result [
        uivlist 0 [
            ui_tool_numinput (concatword $tool_props_focus_water_matname deep #1 arg1) 0 0 10 [
                p_label      = #1(? $arg1 "" "Depth")
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_val_format = i
                p_flags      = $TOOL_COLOUR_ZEROFIX
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Water depth fog" "thickness" 0)

            uifill 0 $ui_tool_elem_space_s

            ui_tool_colour (concatword $tool_props_focus_water_matname deepcolour #1 arg1) [
                p_label      = #1(? $arg1 "" "Colour")
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_val_format = i
                p_flags      = $TOOL_COLOUR_ZEROFIX
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Water depth colour" "color" 0)

            ui_tool_colour (concatword $tool_props_focus_water_matname deepfade #1 arg1) [
                p_label      = [#1(? $arg1 "" "Edge colour")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_val_format = i
                p_flags      = $TOOL_COLOUR_ZEROFIX
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Water edge colour" "color" 0)

            uiclamp 1 1
            uialign* 1
            uialign 1 -1
        ]
    ]
]

# ui_tool_materials_fall_water [
    result [
        uivlist 0 [
            ui_tool_numinput (concatword $tool_props_focus_water_matname fallscrollx #1 arg1) 0 0 1 [
                p_label      = [#1(? $arg1 "" "Scroll X")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Waterfall X scroll" "speed animation" 0)

            ui_tool_numinput (concatword $tool_props_focus_water_matname fallscrolly #1 arg1) 0 0 1 [
                p_label      = [#1(? $arg1 "" "Scroll Y")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Waterfall Y scroll" "speed animation" 0)

            uifill 0 $ui_tool_elem_space_s

            ui_tool_colour (concatword $tool_props_focus_water_matname fallcolour #1 arg1) [
                p_label      = #1(? $arg1 "" "Colour")
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_val_format = i
                p_flags      = $TOOL_COLOUR_ZEROFIX
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Waterfall colour" "color" 0)

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput (concatword $tool_props_focus_water_matname fallrefract #1 arg1) 0 0 0.1 [
                p_label      = #1(? $arg1 "" "Refract")
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Waterfall refract" "" 0)

            ui_tool_colour (concatword $tool_props_focus_water_matname fallrefractcolour #1 arg1) [
                p_label      = [#1(? $arg1 "" "Refract colour")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_val_format = i
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Waterfall refract colour" "color" 0)

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput (concatword $tool_props_focus_water_matname fallspec #1 arg1) 0 0 10 [
                p_label      = #1(? $arg1 "" "Specular")
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_val_format = i
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Waterfall specular" "reflection strength" 0)

            uiclamp 1 1
            uialign* 1
            uialign 1 -1
        ]
    ]
]

# ui_tool_materials_behavior_water [
    result [
        uivlist 0 [
            ui_tool_numinput (concatword $tool_props_focus_water_matname boost #1 arg1) 0 0 0.1 [
                p_label      = #1(? $arg1 "" "Boost")
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Water boost" "physics push" 0)

            ui_tool_numinput (concatword $tool_props_focus_water_matname buoyancy #1 arg1) 0 0 10 [
                p_label      = #1(? $arg1 "" "Buoyancy")
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Water bouyancy" "physics speed push" 0)

            ui_tool_numinput (concatword $tool_props_focus_water_matname speed #1 arg1) 0 0 0.1 [
                p_label      = #1(? $arg1 "" "Speed")
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Water speed" "physics speed push" 0)

            ui_tool_numinput (concatword $tool_props_focus_water_matname submerge #1 arg1) 0 0 0.1 [
                p_label      = #1(? $arg1 "" "Submerge")
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Water submerge" "physics" 0)

            ui_tool_numinput (concatword $tool_props_focus_water_matname coast #1 arg1) 0 0 10 [
                p_label      = #1(? $arg1 "" "Coast")
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Water coast" "physics drag" 0)

            ui_tool_numinput (concatword $tool_props_focus_water_matname extinguish #1 arg1) 0 0 0.1 [
                p_label      = #1(? $arg1 "" "Extinguish")
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Water extinguish" "physics" 0)

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput (concatword $tool_props_focus_water_matname falldist #1 arg1) 0 0 1 [
                p_label      = [#1(? $arg1 "" "Waterfall dist.")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Waterfall push distance" "physics" 0)

            ui_tool_numinput (concatword $tool_props_focus_water_matname fallpush #1 arg1) 0 0 0.1 [
                p_label      = [#1(? $arg1 "" "Waterfall push")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Waterfall push speed" "physics" 0)

            ui_tool_numinput (concatword $tool_props_focus_water_matname fallspeed #1 arg1) 0 0 10 [
                p_label      = [#1(? $arg1 "" "Waterfall speed")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_val_format = i
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Waterfall speed" "physics" 0)

            uiclamp 1 1
            uialign* 1
            uialign 1 -1
        ]
    ]
]

# ui_tool_materials_obit_water [
    result [
        uivlist 0 [
            ui_tool_textinput (concatword obit $tool_props_focus_water_matname) 24 [
                p_label      = "Message"
                p_label_size = $ui_tool_text_size_xs
                p_immediate  = 0
                p_lines     = 3
                p_limit     = 64
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Water obituary" "death message" 0)

            uiclamp 1 1
            uialign* 1
            uialign 1 -1
        ]
    ]
]

// 1:<alt>
# ui_tool_materials_surface_lava [
    result [
        uivlist 0 [
            ui_tool_numinput (concatword $tool_props_focus_lava_matname fog #1 arg1) 0 0 10 [
                p_label      = [#1(? $arg1 "" "Fog distance")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_val_format = i
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Lava fog distance" "thickness" 1)

            uifill 0 $ui_tool_elem_space_s

            ui_tool_colour (concatword $tool_props_focus_lava_matname colour #1 arg1) [
                p_label      = #1(? $arg1 "" "Colour")
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_val_format = i
                p_flags      = $TOOL_COLOUR_ZEROFIX
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Lava colour" "color" 1)

            ui_tool_numinput (concatword $tool_props_focus_lava_matname glowmin #1 arg1) 0 0 0.1 [
                p_label      = [#1(? $arg1 "" "Glow min.")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Lava glow min." "brightness" 1)

            ui_tool_numinput (concatword $tool_props_focus_lava_matname glowmax #1 arg1) 0 0 0.1 [
                p_label      = [#1(? $arg1 "" "Glow max.")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Lava glow max." "brightness" 1)

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput (concatword $tool_props_focus_lava_matname scrollx #1 arg1) 0 0 1 [
                p_label      = [#1(? $arg1 "" "Scroll X")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Lava scroll X" "speed animation" 1)

            ui_tool_numinput (concatword $tool_props_focus_lava_matname scrolly #1 arg1) 0 0 1 [
                p_label      = [#1(? $arg1 "" "Scroll Y")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Lava scroll Y" "speed animation" 1)

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput (concatword $tool_props_focus_lava_matname spec #1 arg1) 0 0 10 [
                p_label      = #1(? $arg1 "" "Specular")
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_val_format = i
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Lava specular" "reflection strength" 1)

            uiclamp 1 1
            uialign* 1
            uialign 1 -1
        ]
    ]
]

# ui_tool_materials_fall_lava [
    result [
        uivlist 0 [
            ui_tool_numinput (concatword $tool_props_focus_lava_matname fallscrollx #1 arg1) 0 0 1 [
                p_label      = [#1(? $arg1 "" "Scroll X")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Lavafall X scroll" "speed animation" 1)

            ui_tool_numinput (concatword $tool_props_focus_lava_matname fallscrolly #1 arg1) 0 0 1 [
                p_label      = [#1(? $arg1 "" "Scroll Y")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Lavafall Y scroll" "speed animation" 1)

            uiclamp 1 1
            uialign* 1
            uialign 1 -1
        ]
    ]
]

# ui_tool_materials_behavior_lava [
    result [
        uivlist 0 [
            ui_tool_numinput (concatword $tool_props_focus_lava_matname boost #1 arg1) 0 0 0.1 [
                p_label      = #1(? $arg1 "" "Boost")
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Lava boost" "physics push" 1)

            ui_tool_numinput (concatword $tool_props_focus_lava_matname buoyancy #1 arg1) 0 0 10 [
                p_label      = #1(? $arg1 "" "Buoyancy")
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Lava bouyancy" "physics speed push" 1)

            ui_tool_numinput (concatword $tool_props_focus_lava_matname speed #1 arg1) 0 0 0.1 [
                p_label      = #1(? $arg1 "" "Speed")
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Lava speed" "physics speed push" 1)

            ui_tool_numinput (concatword $tool_props_focus_lava_matname submerge #1 arg1) 0 0 0.1 [
                p_label      = #1(? $arg1 "" "Submerge")
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Lava submerge" "physics" 1)

            ui_tool_numinput (concatword $tool_props_focus_lava_matname coast #1 arg1) 0 0 10 [
                p_label      = #1(? $arg1 "" "Coast")
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Lava coast" "physics drag" 1)

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput (concatword $tool_props_focus_lava_matname falldist #1 arg1) 0 0 1 [
                p_label      = [#1(? $arg1 "" "Lavafall dist.")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Lavafall push distance" "physics" 1)

            ui_tool_numinput (concatword $tool_props_focus_lava_matname fallpush #1 arg1) 0 0 0.1 [
                p_label      = [#1(? $arg1 "" "Lavafall push")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Lavafall push speed" "physics" 1)

            ui_tool_numinput (concatword $tool_props_focus_lava_matname fallspeed #1 arg1) 0 0 10 [
                p_label      = [#1(? $arg1 "" "Lavafall speed")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_val_format = i
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Lavafall speed" "physics" 1)

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput (concatword $tool_props_focus_lava_matname burndelay #1 arg1) 0 0 500 [
                p_label      = [#1(? $arg1 "" "Burn delay (ms)")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_val_format = i
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Lava burn delay" "physics damage" 1)

            ui_tool_numinput (concatword $tool_props_focus_lava_matname burntime #1 arg1) 0 0 500 [
                p_label      = [#1(? $arg1 "" "Burn time (ms)")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_val_format = i
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Lava burn time" "physics damage" 1)

            uiclamp 1 1
            uialign* 1
            uialign 1 -1
        ]
    ]
]

# ui_tool_materials_obit_lava [
    result [
        uivlist 0 [
            ui_tool_textinput (concatword obit $tool_props_focus_lava_matname) 24 [
                p_label      = "Message"
                p_label_size = $ui_tool_text_size_xs
                p_immediate  = 0
                p_lines     = 3
                p_limit     = 64
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Lava obituary" "death message" 1)

            uiclamp 1 1
            uialign* 1
            uialign 1 -1
        ]
    ]
]

# ui_tool_materials_surface_volfog [
    result [
        uivlist 0 [
            ui_tool_numinput (concatword $tool_props_focus_volfog_matname dist #1 arg1) 0 0 10 [
                p_label      = [#1(? $arg1 "" "Fog distance")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_val_format = i
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Volumetric fog distance" "thickness" 2)

            uifill 0 $ui_tool_elem_space_s

            ui_tool_colour (concatword $tool_props_focus_volfog_matname colour #1 arg1) [
                p_label      = #1(? $arg1 "" "Colour")
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_val_format = i
                p_flags      = $TOOL_COLOUR_ZEROFIX
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Volumetric fog colour" "color" 2)

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput (concatword $tool_props_focus_volfog_matname scrollx #1 arg1) 0 0 1 [
                p_label      = [#1(? $arg1 "" "Scroll X")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Volumetric fog scroll X" "speed animation" 2)

            ui_tool_numinput (concatword $tool_props_focus_volfog_matname scrolly #1 arg1) 0 0 1 [
                p_label      = [#1(? $arg1 "" "Scroll Y")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Volumetric fog scroll Y" "speed animation" 2)

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput (concatword $tool_props_focus_volfog_matname texblend #1 arg1) 0 0 0.1 [
                p_label      = [#1(? $arg1 "" "Texture blend")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Volumetric fog surface texture blend" "blending transparency visibility opacity" 2)

            ui_tool_colour (concatword $tool_props_focus_volfog_matname texcolour #1 arg1) [
                p_label      = [#1(? $arg1 "" "Texture colour")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_val_format = i
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Volumetric fog surface texture colour" "color" 2)

            ui_tool_dropdown (concatword $tool_props_focus_volfog_matname texture #1 arg1) [
                "None"
                "Evolution"
                "Simple"
            ] [
                p_label      = [#1(? $arg1 "" "Texture type")]
                p_label_size = $ui_tool_text_size_xs
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Volumetric fog surface texture type" "" 2)

            uiclamp 1 1
            uialign* 1
            uialign 1 -1
        ]
    ]
]

// 1:<alt>
# ui_tool_materials_deep_volfog [
    result [
        uivlist 0 [
            ui_tool_numinput (concatword $tool_props_focus_volfog_matname deep #1 arg1) 0 0 10 [
                p_label      = #1(? $arg1 "" "Depth")
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_val_format = i
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Volumetric fog depth fog" "thickness" 2)

            uifill 0 $ui_tool_elem_space_s

            ui_tool_colour (concatword $tool_props_focus_volfog_matname deepcolour #1 arg1) [
                p_label      = #1(? $arg1 "" "Colour")
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_val_format = i
                p_flags      = $TOOL_COLOUR_ZEROFIX
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Volumetric fog depth colour" "color" 2)

            // Broken rendering of deepfade, hide for now
            // ui_tool_colour (concatword $tool_props_focus_volfog_matname deepfade #1 arg1) [
            //     p_label = [#1(? $arg1 "" "Edge colour")]
            //     p_label_size = $ui_tool_text_size_xs
            //     p_interval = $ui_tool_mat_param_interval
            //     p_val_format = i
            //     p_flags = $TOOL_COLOUR_ZEROFIX
            // ]

            uiclamp 1 1
            uialign* 1
            uialign 1 -1
        ]
    ]
]

# ui_tool_materials_obit_volfog [
    result [
        uivlist 0 [
            ui_tool_textinput (concatword obit $tool_props_focus_volfog_matname) 24 [
                p_label      = "Message"
                p_label_size = $ui_tool_text_size_xs
                p_immediate  = 0
                p_lines     = 3
                p_limit     = 64
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Volumetric fog obituary" "death message" 2)

            uiclamp 1 1
            uialign* 1
            uialign 1 -1
        ]
    ]
]

// 1:<alt>
# ui_tool_materials_surface_glass [
    result [
        uivlist 0 [
            ui_tool_colour (concatword $tool_props_focus_glass_matname colour #1 arg1) [
                p_label      = #1(? $arg1 "" "Colour")
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_val_format = i
                p_flags      = $TOOL_COLOUR_ZEROFIX
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Glass colour" "color" 3)

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput (concatword $tool_props_focus_glass_matname refract #1 arg1) 0 0 0.1 [
                p_label      = #1(? $arg1 "" "Refract")
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Glass refract" "" 3)

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput (concatword $tool_props_focus_glass_matname spec #1 arg1) 0 0 10 [
                p_label      = #1(? $arg1 "" "Specular")
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_val_format = i
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Glass specular" "reflection strength" 3)

            uiclamp 1 1
            uialign* 1
            uialign 1 -1
        ]
    ]
]

# ui_tool_materials_obit_death [
    result [
        uivlist 0 [
            ui_tool_textinput obitdeath 24 [
                p_label      = "Message"
                p_label_size = $ui_tool_text_size_xs
                p_immediate  = 0
                p_lines     = 3
                p_limit     = 64
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Death volume obituary" "message" 4)

            uiclamp 1 1
            uialign* 1
            uialign 1 -1
        ]
    ]
]

# ui_tool_materials_behavior_hurt [
    result [
        uivlist 0 [
            ui_tool_numinput hurtdamage 0 0 10 [
                p_label      = "Damage"
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_val_format = i
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Hurt volume damage" "" 5)

            ui_tool_numinput hurtdelay 0 0 500 [
                p_label      = "Damage delay (ms)"
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_val_format = i
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Hurt volume damage delay" "" 5)

            #ui_tool_divider

            ui_tool_compactswitch hurtresidual [
                p_label = "Bleed"
                p_get   = [
                    & $hurtresidual 2
                ]
                p_set   = [
                    ^ $hurtresidual 2
                ]
                p_width = $ui_tool_button_width_s_unscaled
                p_id    = #(tool_get_id)
            ]
            #(tool_mat_register_control "Enable hurt volume bleed effect" "" 5)
            uialign- 1

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput hurtbleeddamage 0 0 10 [
                p_label      = "Bleed damage"
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_val_format = i
                p_disabled   = (! (& $hurtresidual 2))
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Hurt volume bleed damage" "" 5)

            ui_tool_numinput hurtbleeddelay 0 0 500 [
                p_label      = "Bleed delay (ms)"
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_val_format = i
                p_disabled   = (! (& $hurtresidual 2))
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Hurt volume bleed delay" "" 5)

            ui_tool_numinput hurtbleedtime 0 0 500 [
                p_label      = "Bleed time (ms)"
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_val_format = i
                p_disabled   = (! (& $hurtresidual 2))
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Hurt volume bleed time" "" 5)

            #ui_tool_divider

            ui_tool_compactswitch hurtresidual [
                p_label = "Burn"
                p_get   = [
                    & $hurtresidual 1
                ]
                p_set   = [
                    ^ $hurtresidual 1
                ]
                p_width = $ui_tool_button_width_s_unscaled
                p_id    = #(tool_get_id)
            ]
            #(tool_mat_register_control "Enable hurt volume burn effect" "" 5)
            uialign- 1

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput hurtburndamage 0 0 10 [
                p_label      = "Burn damage"
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_val_format = i
                p_disabled   = (! (& $hurtresidual 1))
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Hurt volume burn damage" "" 5)

            ui_tool_numinput hurtburndelay 0 0 500 [
                p_label      = "Burn delay (ms)"
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_val_format = i
                p_disabled   = (! (& $hurtresidual 1))
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Hurt volume burn delay" "" 5)

            ui_tool_numinput hurtburntime 0 0 500 [
                p_label      = "Burn time (ms)"
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_val_format = i
                p_disabled   = (! (& $hurtresidual 1))
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Hurt volume burn time" "" 5)

            #ui_tool_divider

            ui_tool_compactswitch hurtresidual [
                p_label = "Shock"
                p_get   = [
                    & $hurtresidual 4
                ]
                p_set   = [
                    ^ $hurtresidual 4
                ]
                p_width = $ui_tool_button_width_s_unscaled
                p_id    = #(tool_get_id)
            ]
            #(tool_mat_register_control "Enable hurt volume shock effect" "" 5)
            uialign- 1

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput hurtshockdamage 0 0 10 [
                p_label      = "Shock damage"
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_val_format = i
                p_disabled   = (! (& $hurtresidual 4))
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Hurt volume shock damage" "" 5)

            ui_tool_numinput hurtshockstun 0 0 1 [
                p_label      = "Shock stun"
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_val_format = i
                p_disabled   = (! (& $hurtresidual 4))
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Hurt volume shock stun" "" 5)

            ui_tool_numinput hurtshockstunfall 0 0 0.01 [
                p_label      = "Shock stun fall"
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_disabled   = (! (& $hurtresidual 4))
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Hurt volume shock stun fall" "" 5)

            ui_tool_numinput hurtshockstunscale 0 0 0.1 [
                p_label      = "Shock stun scale"
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_disabled   = (! (& $hurtresidual 4))
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Hurt volume shock stun scale" "" 5)

            ui_tool_numinput hurtshockstuntime 0 0 500 [
                p_label      = "Shock stun time (ms)"
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_val_format = i
                p_disabled   = (! (& $hurtresidual 4))
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Hurt volume shock stun time" "" 5)

            ui_tool_numinput hurtshockdelay 0 0 500 [
                p_label      = "Shock delay (ms)"
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_val_format = i
                p_disabled   = (! (& $hurtresidual 4))
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Hurt volume shock delay" "" 5)

            ui_tool_numinput hurtshocktime 0 0 500 [
                p_label      = "Shock time (ms)"
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_mat_param_interval
                p_val_format = i
                p_disabled   = (! (& $hurtresidual 4))
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Hurt volume shock time" "" 5)
        ]
    ]
]

# ui_tool_materials_obit_hurt [
    result [
        uivlist 0 [
            ui_tool_textinput obithurt 24 [
                p_label      = "Message"
                p_label_size = $ui_tool_text_size_xs
                p_immediate  = 0
                p_lines     = 3
                p_limit     = 64
                p_id         = #(tool_get_id)
            ]
            #(tool_mat_register_control "Hurt volume obituary" "message" 5)

            uiclamp 1 1
            uialign* 1
            uialign 1 -1
        ]
    ]
]

// 1:<contents> 2:<text> 3:<mat>
# ui_tool_mat_param_group [
    result [
        uitablerow [
            uiclamp 1 1
            uipad $ui_tool_elem_space_m $ui_tool_elem_space_xl $ui_tool_elem_space_m 0 [
                uitext [#1 arg2] $ui_tool_text_size_s [
                    uitextrotate 3
                ]
            ]
            uialign- -1
            #1 arg1
        ]
        uitablerow [] [
            @@@ui_tool_divider
        ]
    ]
]

// 1:<contents> 2:<text> 3:<mat>
# ui_tool_mat_param_group_noalt [
    result [
        uitablerow [] [
            uiclamp 1 1
            uihlist $ui_tool_elem_space_xl [
                uipad $ui_tool_elem_space_m $ui_tool_elem_space_xl $ui_tool_elem_space_m 0 [
                    uitext [#1 arg2] $ui_tool_text_size_s [
                        uitextrotate 3
                    ]
                ]
                uialign- -1
                #1 arg1
                uialign- 1
            ]
            uialign- -1
            uialign -1
        ]
        uifill 0 $ui_tool_elem_space_s
        uiline $ui_tool_dark_accent_colour 0 0 [ uiclamp 1 1 ]
        uifill 0 $ui_tool_elem_space_s
    ]
]

// 1:<ui> 2:<text> 3:<mat>
ui_tool_mat_params = [
    ui_tool_mat_param_group [
        @($arg1)
        @($arg1 alt)
    ] $arg2 $arg3
]

// 1:<ui> 2:<text> 3:<mat>
ui_tool_mat_params_noalt = [
    ui_tool_mat_param_group_noalt [
        @($arg1)
    ] $arg2 $arg3
]

// 1:<content> 2:<mat>
# ui_tool_mat_table [
    local _focusvar _focusmatnamevar
    _focusvar = [tool_props_focus_@arg2]
    _focusmatnamevar = [tool_props_focus_@[arg2]_matname]

    result [
        uitablerow [] [
            uicolour $ui_tool_dark_colour 0 0 [
                uihlist 0 [
                    loop i $tool_mat_num_variants [
                        local _col _selcol
                        _col = $(concatword #1 arg2 (? $i (+ $i 1) "") "colour")
                        _selcol = (? (= $i $#1 _focusvar) $ui_tool_accent_colour $ui_tool_dark_colour)

                        ui_tool_button [
                            p_width = 0.1
                            p_height = 0.03
                            p_on_click = [
                                #1 _focusvar = #6 i
                                #1 _focusmatnamevar = #6(concatword #1 arg2 (? $i (+ $i 1) ""))
                            ]
                            p_children = [
                                uioutline #6 _selcol
                                uiclamp- 1 1 1 1
                                uihlist $ui_tool_elem_space_s [
                                    uicolour #6 _col 0.01 0.01
                                    uicolourtext #6(concatword "#" $i) #6 _selcol $ui_tool_text_size_xs_unscaled
                                ]
                            ]
                        ]
                    ]
                    uialign* -1
                ]
                uialign- 1
            ]
        ]

        ui_tool_vscrollarea [
            uiclamp 1 1
            uitable $ui_tool_elem_space_l $ui_tool_elem_space_l [
                uiclamp 1 1
                uitableheader [
                    uifill
                    uicolourtext "Default" (? (<= $forcemapvariant 1) $ui_tool_accent_colour $ui_tool_dark_accent_colour) $ui_tool_text_size_s
                    uicolourtext "Alternate" (? (= $forcemapvariant 2) $ui_tool_accent_colour $ui_tool_dark_accent_colour) $ui_tool_text_size_s
                ]

                uiline $ui_tool_dark_accent_colour 0 0 [ uiclamp 1 1 ]

                #1 arg1
            ]
        ] [
            p_height = 0.6
            p_id     = #(tool_get_id)
        ]
    ]
]

ui_tool_mat_tab_water = [
    @(ui_tool_mat_table [
        @(ui_tool_mat_params ui_tool_materials_surface_water "Surface" water)
        @(ui_tool_mat_params ui_tool_materials_deep_water "Deep phase" water)
        @(ui_tool_mat_params ui_tool_materials_fall_water "Waterfall" water)
        @(ui_tool_mat_params ui_tool_materials_behavior_water "Behavior" water)
        @(ui_tool_mat_params_noalt ui_tool_materials_obit_water "Obituary" water)
    ] water)
]

ui_tool_mat_tab_lava = [
    @(ui_tool_mat_table [
        @(ui_tool_mat_params ui_tool_materials_surface_lava "Surface" lava)
        @(ui_tool_mat_params ui_tool_materials_fall_lava "Lavafall" lava)
        @(ui_tool_mat_params ui_tool_materials_behavior_lava "Behavior" lava)
        @(ui_tool_mat_params_noalt ui_tool_materials_obit_lava "Obituary" lava)
    ] lava)
]

ui_tool_mat_tab_fog = [
    @(ui_tool_mat_table [
        @(ui_tool_mat_params ui_tool_materials_surface_volfog "Surface" volfog)
        @(ui_tool_mat_params ui_tool_materials_deep_volfog "Deep phase" volfog)
        @(ui_tool_mat_params_noalt ui_tool_materials_obit_volfog "Obituary" volfog)
    ] volfog)
]

ui_tool_mat_tab_glass = [
    @(ui_tool_mat_table [
        @(ui_tool_mat_params ui_tool_materials_surface_glass "Surface" glass)
    ] glass)
]

ui_tool_mat_tab_death = [
    @(ui_tool_mat_params_noalt ui_tool_materials_obit_death "Obituary" death)
]

ui_tool_mat_tab_hurt = [
    @(ui_tool_mat_params_noalt ui_tool_materials_behavior_hurt "Behavior" hurt)
    @(ui_tool_mat_params_noalt ui_tool_materials_obit_hurt "Obituary" hurt)
]

ui_tool_materials_properties = [
    uitext "Material properties" $ui_tool_text_size_s
    uialign- -1 -2

    uifill 0 $ui_tool_elem_space_l

    ui_tool_vtabs tool_mat_tabs [
        "textures/icons/edit/mat_water"
        "textures/icons/edit/mat_lava"
        "textures/icons/edit/mat_volfog"
        "textures/icons/edit/mat_glass"
        "textures/icons/edit/mat_death"
        "textures/icons/edit/mat_hurt"
    ] [
        "Water"
        "Lava"
        "Fog volume"
        "Glass"
        "Death"
        "Hurt"
    ] [
        ui_tool_mat_tab_water
        ui_tool_mat_tab_lava
        ui_tool_mat_tab_fog
        ui_tool_mat_tab_glass
        ui_tool_mat_tab_death
        ui_tool_mat_tab_hurt
    ]
]

ui_tool_materials = [
    uivlist $ui_toolpanel_elem_space [
        uiclamp 1 1 1 1

        @@ui_tool_materials_list
        @@ui_tool_materials_controls

        uifill 0 $ui_tool_elem_space_s
        uiline $ui_tool_dark_accent_colour 0 0 [ uiclamp 1 1 ]
        uifill 0 $ui_tool_elem_space_s

        @@ui_tool_materials_properties
    ]
]
