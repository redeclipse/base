ui_tool_env_param_interval = (? $isonline 250 0)

// 1:<text> 2:<contents>
ui_tool_env_param_group = [
    uitablerow [
        uistyle clampx
        uipad $ui_tool_elem_space_m $ui_tool_elem_space_xl $ui_tool_elem_space_m 0 [
            uitext $arg1 $ui_tool_text_size_s [
                uitextrotate 3
            ]
            uialign -1
        ]
        @arg2
    ]
    uitablerow [] [
        @@ui_tool_divider
    ]
]

# ui_tool_env_skybox = [
    result [
        uivlist 0 [
            ui_tool_skyboxselect skybox#1 arg1 [
                p_id = #(tool_get_id)
            ]
            #(tool_env_register_control "Skybox texture" "" "skybox")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput skyblend#1 arg1 0 1 0.1 [
                p_label      = [#1(? $arg1 "" "Blend")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Skybox blend" "blending transparency visibility opacity" "skybox")

            ui_tool_numinput skyoverbright#1 arg1 1 16 0.5 [
                p_label      = [#1(? $arg1 "" "Overbright")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Skybox overbright" "brightness visibility" "skybox")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput yawsky#1 arg1 0 360 1 [
                p_label      = [#1(? $arg1 "" "Yaw")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_val_format = i
                p_circular   = 1
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Skybox yaw" "rotation rotate" "skybox")

            ui_tool_numinput pitchsky#1 arg1 0 360 1 [
                p_label      = [#1(? $arg1 "" "Pitch")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_val_format = i
                p_circular   = 1
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Skybox pitch" "rotation rotate" "skybox")

            ui_tool_numinput rollsky#1 arg1 0 360 1 [
                p_label      = [#1(? $arg1 "" "Roll")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_val_format = i
                p_circular   = 1
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Skybox roll" "rotation rotate" "skybox")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput spinsky#1 arg1 -720 720 0.5 [
                p_label      = [#1(? $arg1 "" "Spin yaw")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Skybox yaw spin" "rotation rotate" "skybox")

            ui_tool_numinput spinskypitch#1 arg1 -720 720 0.5 [
                p_label      = [#1(? $arg1 "" "Spin pitch")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Skybox pitch spin" "rotation rotate" "skybox")

            ui_tool_numinput spinskyroll#1 arg1 -720 720 0.5 [
                p_label      = [#1(? $arg1 "" "Spin roll")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Skybox roll spin" "rotation rotate" "skybox")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_colour skycolour#1 arg1 [
                p_label      = [#1(? $arg1 "" "Colour")]
                p_label_size = $ui_tool_text_size_xs
                p_val_format = i
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Skybox colour" "color" "skybox")

            uistyle clampx
            uipropchild [uialign 1]
            uistyle righttop
        ]
    ]
]

# ui_tool_env_skybg = [
    result [
        uivlist 0 [
            ui_tool_colour skybgcolour#1 arg1 [
                p_label      = [#1(? $arg1 "" "Colour")]
                p_label_size = $ui_tool_text_size_xs
                p_val_format = i
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Skybox background colour" "color" "skybox")

            uistyle clampx
            uipropchild [uialign 1]
            uistyle righttop
        ]
    ]
]

# ui_tool_env_cloudlayer = [
    result [
        uivlist 0 [
            ui_tool_imageselect cloudlayer#1 arg1 $tool_env_clouds [
                p_tip_simple = "Click to browse cloudlayers"
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud layer #1 texture" "" "cloudlayer")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput cloudlayerblend#1 arg1 0 1 0.1 [
                p_label      = [#1(? $arg1 "" "Blend")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud layer #1 blend" "blending transparency visibility opacity" "cloudlayer")

            ui_tool_numinput cloudfade#1 arg1 0 1 0.1 [
                p_label      = [#1(? $arg1 "" "Fade")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_tip_simple = "Edge fade strength"
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud layer #1 fade" "blending transparency visibility smoothing" "cloudlayer")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_switch cloudfarplane#1 arg1 [
                p_label      = [#1(? $arg1 "" "Render")]
                p_label_size = $ui_tool_text_size_xs
                p_options    = ["Worldspace" "Skybox"]
                p_tip_simple = "Worldspace - Clouds are rendered as part of the map;^nSkybox - Clouds are rendered in the skybox itself, seaprate from the map"
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud layer #1 render space" "worldspace above world map far" "cloudlayer")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_compactswitch cloudshadow#1 arg1 [
                p_label = "Enable shadow"
                p_id    = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud layer #1 shadow" "" "cloudlayer")

            ui_tool_numinput cloudshadowblend#1 arg1 0 0 0.1 [
                p_disabled   = (! $cloudshadow#1 arg1)
                p_label      = [#1(? $arg1 "" "Shadow strength")]
                p_label_size = $ui_tool_text_size_xs
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud layer #1 shadow strength" "blending transparency visibility opacity" "cloudlayer")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput cloudheight#1 arg1 -2 2 0.1 [
                p_label      = [#1(? $arg1 "" "Height")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud layer #1 height" "space position" "cloudlayer")

            ui_tool_numinput cloudscale#1 arg1 1e-06 64 0.1 [
                p_label      = [#1(? $arg1 "" "Scale")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud layer #1 scale" "size transform" "cloudlayer")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput cloudoffsetx#1 arg1 0 1 0.1 [
                p_label      = [#1(? $arg1 "" "Offset X")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud layer #1 X offset" "transform" "cloudlayer")

            ui_tool_numinput cloudoffsety#1 arg1 0 1 0.1 [
                p_label      = [#1(? $arg1 "" "Offset Y")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud layer #1 Y offset" "transform" "cloudlayer")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput cloudscrollx#1 arg1 -16 16 0.01 [
                p_label      = [#1(? $arg1 "" "Scroll X")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud layer #1 X scroll" "transform" "cloudlayer")

            ui_tool_numinput cloudscrolly#1 arg1 -16 16 0.01 [
                p_label      = [#1(? $arg1 "" "Scroll Y")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud layer #1 Y scroll" "transform" "cloudlayer")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput spincloudlayer#1 arg1 -720 720 0.5 [
                p_label      = [#1(? $arg1 "" "Spin")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud layer #1 spin" "rotate rotation" "cloudlayer")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput cloudsubdiv#1 arg1 4 64 1 [
                p_label      = [#1(? $arg1 "" "Subdivision")]
                p_label_size = $ui_tool_text_size_xs
                p_val_format = i
                p_interval   = $ui_tool_env_param_interval
                p_tip_simple = "Number of edges"
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud layer #1 subdivision" "shape edges" "cloudlayer")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_colour cloudlayercolour#1 arg1 [
                p_label      = [#1(? $arg1 "" "Colour")]
                p_label_size = $ui_tool_text_size_xs
                p_val_format = i
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud layer #1 colour" "color" "cloudlayer")

            uistyle clampx
            uipropchild [uialign 1]
            uistyle righttop
        ]
    ]
]

# ui_tool_env_envlayer = [
    result [
        uivlist 0 [
            ui_tool_imageselect envlayer#1 arg1 $tool_env_clouds [
                p_tip_simple = "Click to browse cloudlayers"
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud layer #2 texture" "" "cloudlayer")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput envlayerblend#1 arg1 0 1 0.1 [
                p_label      = [#1(? $arg1 "" "Blend")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud layer #2 blend" "blending transparency visibility opacity" "cloudlayer")

            ui_tool_numinput envfade#1 arg1 0 1 0.1 [
                p_label      = [#1(? $arg1 "" "Fade")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_tip_simple = "Edge fade strength"
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud layer #2 fade" "blending transparency visibility smoothing" "cloudlayer")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_switch envfarplane#1 arg1 [
                p_label      = [#1(? $arg1 "" "Render")]
                p_label_size = $ui_tool_text_size_xs
                p_options    = ["Worldspace" "Skybox"]
                p_tip_simple = "Worldspace - Clouds are rendered as part of the map;^nSkybox - Clouds are rendered in the skybox itself, seaprate from the map"
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud layer #2 render space" "worldspace above world map far" "cloudlayer")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_compactswitch envshadow#1 arg1 [
                p_label = "Enable shadow"
                p_id    = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud layer #2 shadow" "" "cloudlayer")

            ui_tool_numinput envshadowblend#1 arg1 0 0 0.1 [
                p_disabled   = (! $envshadow#1 arg1)
                p_label      = [#1(? $arg1 "" "Shadow strength")]
                p_label_size = $ui_tool_text_size_xs
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud layer #2 shadow strength" "blending transparency visibility opacity" "cloudlayer")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput envheight#1 arg1 -2 2 0.1 [
                p_label      = [#1(? $arg1 "" "Height")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud layer #2 height" "space position" "cloudlayer")

            ui_tool_numinput envscale#1 arg1 1e-06 64 0.1 [
                p_label      = [#1(? $arg1 "" "Scale")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud layer #2 scale" "size transform" "cloudlayer")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput envoffsetx#1 arg1 0 1 0.1 [
                p_label      = [#1(? $arg1 "" "Offset X")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud layer #2 X offset" "transform" "cloudlayer")

            ui_tool_numinput envoffsety#1 arg1 0 1 0.1 [
                p_label      = [#1(? $arg1 "" "Offset Y")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud layer #2 Y offset" "transform" "cloudlayer")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput envscrollx#1 arg1 -16 16 0.01 [
                p_label      = [#1(? $arg1 "" "Scroll X")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud layer #2 X scroll" "transform" "cloudlayer")

            ui_tool_numinput envscrolly#1 arg1 -16 16 0.01 [
                p_label      = [#1(? $arg1 "" "Scroll Y")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud layer #2 Y scroll" "transform" "cloudlayer")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput spinenvlayer#1 arg1 -720 720 0.5 [
                p_label      = [#1(? $arg1 "" "Spin")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud layer #2 spin" "rotate rotation" "cloudlayer")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput envsubdiv#1 arg1 4 64 1 [
                p_label      = [#1(? $arg1 "" "Subdivision")]
                p_label_size = $ui_tool_text_size_xs
                p_val_format = i
                p_interval   = $ui_tool_env_param_interval
                p_tip_simple = "Number of edges"
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud layer #2 subdivision" "shape edges" "cloudlayer")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_colour envlayercolour#1 arg1 [
                p_label      = [#1(? $arg1 "" "Colour")]
                p_label_size = $ui_tool_text_size_xs
                p_val_format = i
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud layer #2 colour" "color" "cloudlayer")

            uistyle clampx
            uipropchild [uialign 1]
            uistyle righttop
        ]
    ]
]

# ui_tool_env_cloudbox = [
    result [
        uivlist 0 [
            ui_tool_skyboxselect cloudbox#1 arg1 [
                p_id = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud box texture" "" "cloudbox")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput cloudblend#1 arg1 0 1 0.1 [
                p_label      = [#1(? $arg1 "" "Blend")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud box blend" "blending transparency visibility opacity" "cloudbox")

            ui_tool_numinput cloudclip#1 arg1 0 1 0.1 [
                p_label      = [#1(? $arg1 "" "Clip")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud clip" "cut visibility" "cloudbox")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput spinclouds#1 arg1 -720 720 0.5 [
                p_label      = [#1(? $arg1 "" "Spin yaw")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud box yaw spin" "rotation rotate" "cloudbox")

            ui_tool_numinput spincloudspitch#1 arg1 -720 720 0.5 [
                p_label      = [#1(? $arg1 "" "Spin pitch")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud box pitch spin" "rotation rotate" "cloudbox")

            ui_tool_numinput spincloudsroll#1 arg1 -720 720 0.5 [
                p_label      = [#1(? $arg1 "" "Spin roll")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud box roll spin" "rotation rotate" "cloudbox")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_colour cloudcolour#1 arg1 [
                p_label      = [#1(? $arg1 "" "Colour")]
                p_label_size = $ui_tool_text_size_xs
                p_val_format = i
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud box colour" "color" "cloudbox")

            uistyle clampx
            uipropchild [uialign 1]
            uistyle righttop
        ]
    ]
]

# ui_tool_env_cloudcylinder = [
    result [
        uivlist 0 [
            ui_tool_imageselect cloudcylinderlayer#1 arg1 $tool_env_clouds [
                p_tip_simple = "Click to browse cloudlayers"
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud cylinder #1 texture" "" "cloudcylinder")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput cloudcylinderlayerblend#1 arg1 0 1 0.1 [
                p_label      = [#1(? $arg1 "" "Blend")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud cylinder #1 blend" "blending transparency visibility opacity" "cloudcylinder")

            ui_tool_numinput cloudcylinderfade#1 arg1 0 1 0.1 [
                p_label      = [#1(? $arg1 "" "Fade")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_tip_simple = "Edge fade strength"
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud cylinder #1 fade" "blending transparency visibility smoothing" "cloudcylinder")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_switch cloudcylinderfarplane#1 arg1 [
                p_label      = [#1(? $arg1 "" "Render")]
                p_label_size = $ui_tool_text_size_xs
                p_options    = ["Worldspace" "Skybox"]
                p_tip_simple = "Worldspace - Clouds are rendered as part of the map;^nSkybox - Clouds are rendered in the skybox itself, seaprate from the map"
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud cylinder #1 render space" "worldspace above world map far" "cloudcylinder")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_compactswitch cloudcylindershadow#1 arg1 [
                p_label = "Enable shadow"
                p_id    = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud cylinder #1 shadow" "" "cloudcylinder")

            ui_tool_numinput cloudcylindershadowblend#1 arg1 0 0 0.1 [
                p_disabled   = (! $cloudcylindershadow#1 arg1)
                p_label      = [#1(? $arg1 "" "Shadow strength")]
                p_label_size = $ui_tool_text_size_xs
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud cylinder #1 shadow strength" "blending transparency visibility opacity" "cloudcylinder")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput cloudcylinderheight#1 arg1 -2 2 0.1 [
                p_label      = [#1(? $arg1 "" "Height")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud cylinder #1 height" "space position" "cloudcylinder")

            ui_tool_numinput cloudcylinderscale#1 arg1 1e-06 64 0.1 [
                p_label      = [#1(? $arg1 "" "Scale")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud cylinder #1 scale" "size transform" "cloudcylinder")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput cloudcylinderoffsetx#1 arg1 0 1 0.1 [
                p_label      = [#1(? $arg1 "" "Offset X")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud cylinder #1 X offset" "transform" "cloudcylinder")

            ui_tool_numinput cloudcylinderoffsety#1 arg1 0 1 0.1 [
                p_label      = [#1(? $arg1 "" "Offset Y")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud cylinder #1 Y offset" "transform" "cloudcylinder")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput cloudcylinderscrollx#1 arg1 -16 16 0.01 [
                p_label      = [#1(? $arg1 "" "Scroll X")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud cylinder #1 X scroll" "transform" "cloudcylinder")

            ui_tool_numinput cloudcylinderscrolly#1 arg1 -16 16 0.01 [
                p_label      = [#1(? $arg1 "" "Scroll Y")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud cylinder #1 Y scroll" "transform" "cloudcylinder")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput spincloudcylinderlayer#1 arg1 -720 720 0.5 [
                p_label      = [#1(? $arg1 "" "Spin")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud cylinder #1 spin" "rotate rotation" "cloudcylinder")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput cloudcylindersubdiv#1 arg1 4 64 1 [
                p_label      = [#1(? $arg1 "" "Subdivision")]
                p_label_size = $ui_tool_text_size_xs
                p_val_format = i
                p_interval   = $ui_tool_env_param_interval
                p_tip_simple = "Number of edges"
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud cylinder #1 subdivision" "shape edges" "cloudcylinder")

            ui_tool_numinput cloudcylinderrepeat#1 arg1 -64 64 1 [
                p_label      = [#1(? $arg1 "" "Repeats")]
                p_label_size = $ui_tool_text_size_xs
                p_val_format = i
                p_interval   = $ui_tool_env_param_interval
                p_tip_simple = "Number of repeats"
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud cylinder #1 repeat" "texture repeat" "cloudcylinder")

            ui_tool_numinput cloudcylinderdist#1 arg1 0 1 0.1 [
                p_label      = [#1(? $arg1 "" "Distance")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_tip_simple = "Distance"
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud cylinder #1 distance" "shape distance" "cloudcylinder")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_colour cloudcylinderlayercolour#1 arg1 [
                p_label      = [#1(? $arg1 "" "Colour")]
                p_label_size = $ui_tool_text_size_xs
                p_val_format = i
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud cylinder #1 colour" "color" "cloudcylinder")

            uistyle clampx
            uipropchild [uialign 1]
            uistyle righttop
        ]
    ]
]

# ui_tool_env_envcylinder = [
    result [
        uivlist 0 [
            ui_tool_imageselect envcylinderlayer#1 arg1 $tool_env_clouds [
                p_tip_simple = "Click to browse cloudlayers"
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud cylinder #2 texture" "" "cloudcylinder")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput envcylinderlayerblend#1 arg1 0 1 0.1 [
                p_label      = [#1(? $arg1 "" "Blend")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud cylinder #2 blend" "blending transparency visibility opacity" "cloudcylinder")

            ui_tool_numinput envcylinderfade#1 arg1 0 1 0.1 [
                p_label      = [#1(? $arg1 "" "Fade")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_tip_simple = "Edge fade strength"
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud cylinder #2 fade" "blending transparency visibility smoothing" "cloudcylinder")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_switch envcylinderfarplane#1 arg1 [
                p_label      = [#1(? $arg1 "" "Render")]
                p_label_size = $ui_tool_text_size_xs
                p_options    = ["Worldspace" "Skybox"]
                p_tip_simple = "Worldspace - Clouds are rendered as part of the map;^nSkybox - Clouds are rendered in the skybox itself, seaprate from the map"
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud cylinder #2 render space" "worldspace above world map far" "cloudcylinder")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_compactswitch envcylindershadow#1 arg1 [
                p_label = "Enable shadow"
                p_id    = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud cylinder #2 shadow" "" "cloudcylinder")

            ui_tool_numinput envcylindershadowblend#1 arg1 0 0 0.1 [
                p_disabled   = (! $envcylindershadow#1 arg1)
                p_label      = [#1(? $arg1 "" "Shadow strength")]
                p_label_size = $ui_tool_text_size_xs
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud cylinder #2 shadow strength" "blending transparency visibility opacity" "cloudcylinder")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput envcylinderheight#1 arg1 -2 2 0.1 [
                p_label      = [#1(? $arg1 "" "Height")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud cylinder #2 height" "space position" "cloudcylinder")

            ui_tool_numinput envcylinderscale#1 arg1 1e-06 64 0.1 [
                p_label      = [#1(? $arg1 "" "Scale")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud cylinder #2 scale" "size transform" "cloudcylinder")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput envcylinderoffsetx#1 arg1 0 1 0.1 [
                p_label      = [#1(? $arg1 "" "Offset X")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud cylinder #2 X offset" "transform" "cloudcylinder")

            ui_tool_numinput envcylinderoffsety#1 arg1 0 1 0.1 [
                p_label      = [#1(? $arg1 "" "Offset Y")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud cylinder #2 Y offset" "transform" "cloudcylinder")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput envcylinderscrollx#1 arg1 -16 16 0.01 [
                p_label      = [#1(? $arg1 "" "Scroll X")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud cylinder #2 X scroll" "transform" "cloudcylinder")

            ui_tool_numinput envcylinderscrolly#1 arg1 -16 16 0.01 [
                p_label      = [#1(? $arg1 "" "Scroll Y")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud cylinder #2 Y scroll" "transform" "cloudcylinder")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput spinenvcylinderlayer#1 arg1 -720 720 0.5 [
                p_label      = [#1(? $arg1 "" "Spin")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud cylinder #2 spin" "rotate rotation" "cloudcylinder")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput envcylindersubdiv#1 arg1 4 64 1 [
                p_label      = [#1(? $arg1 "" "Subdivision")]
                p_label_size = $ui_tool_text_size_xs
                p_val_format = i
                p_interval   = $ui_tool_env_param_interval
                p_tip_simple = "Number of edges"
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud cylinder #2 subdivision" "shape edges" "cloudcylinder")

            ui_tool_numinput envcylinderrepeat#1 arg1 -64 64 1 [
                p_label      = [#1(? $arg1 "" "Repeats")]
                p_label_size = $ui_tool_text_size_xs
                p_val_format = i
                p_interval   = $ui_tool_env_param_interval
                p_tip_simple = "Number of repeats"
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud cylinder #1 repeat" "texture repeat" "cloudcylinder")

            ui_tool_numinput envcylinderdist#1 arg1 0 1 0.1 [
                p_label      = [#1(? $arg1 "" "Distance")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_tip_simple = "Distance"
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud cylinder #1 distance" "shape distance" "cloudcylinder")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_colour envcylinderlayercolour#1 arg1 [
                p_label      = [#1(? $arg1 "" "Colour")]
                p_label_size = $ui_tool_text_size_xs
                p_val_format = i
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Cloud cylinder #2 colour" "color" "cloudcylinder")

            uistyle clampx
            uipropchild [uialign 1]
            uistyle righttop
        ]
    ]
]

# ui_tool_env_atmo = [
    result [
        uivlist 0 [
            ui_tool_checkbox atmo#1 arg1 [
                p_label_size = $ui_tool_text_size_xs
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Enable atmosphere" "" "atmosphere")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_switch atmo#1 arg1 [
                p_disabled   = @(! $atmo#1 arg1)
                p_label      = [#1(? $arg1 "" "Order")]
                p_options    = ["Front" "Back"]
                p_get        = [ = $arg1 2 ]
                p_set        = [ at [ 2 1 ] (- $arg1 1) ]
                p_tip_simple = "Whether atmo should be rendered in front or behind the skybox"
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Atmosphere drawing order" "render" "atmosphere")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_switch atmostyle#1 arg1 [
                p_disabled   = @(! $atmo#1 arg1)
                p_label      = [#1(? $arg1 "" "Style")]
                p_options    = ["Full" "Sundisk"]
                p_tip_simple = "Whether atmo should fully render, or only contain the sun disk"
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Atmosphere drawing style" "render" "atmosphere")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput atmoblend#1 arg1 0 1 0.1 [
                p_disabled   = @(! $atmo#1 arg1)
                p_label      = [#1(? $arg1 "" "Blend")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Atmosphere blend" "blending transparency visibility opacity" "atmosphere")

            ui_tool_numinput atmobright#1 arg1 0 16 0.1 [
                p_disabled   = @(! $atmo#1 arg1)
                p_label      = [#1(? $arg1 "" "Brightness")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Atmosphere brightness" "brightness visibility" "atmosphere")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput atmodensity#1 arg1 0 1 0.1 [
                p_disabled   = @(! $atmo#1 arg1)
                p_label      = [#1(? $arg1 "" "Density")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_tip_simple = "Air density"
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Atmosphere density" "color colour" "atmosphere")

            ui_tool_numinput atmohaze#1 arg1 0 100 0.1 [
                p_disabled   = @(! $atmo#1 arg1)
                p_label      = [#1(? $arg1 "" "Haze")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_tip_simple = "Amount of haze in the atmosphere"
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Atmosphere haze" "color colour" "atmosphere")

            ui_tool_numinput atmoheight#1 arg1 1e-06 1000000 0.1 [
                p_disabled   = @(! $atmo#1 arg1)
                p_label      = [#1(? $arg1 "" "Height")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_tip_simple = "How high the atmosphere reaches"
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Atmosphere height" "size scale" "atmosphere")

            ui_tool_numinput atmoozone#1 arg1 0 100 1 [
                p_disabled   = @(! $atmo#1 arg1)
                p_label      = [#1(? $arg1 "" "Ozone")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_tip_simple = "Amount of ozone in the atmosphere"
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Atmosphere ozone" "color colour" "atmosphere")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput atmoplanetsize#1 arg1 0.01 1000000 1 [
                p_disabled   = @(! $atmo#1 arg1)
                p_label      = [#1(? $arg1 "" "Planet size")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Atmosphere planet size" "planet scale" "atmosphere")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput atmolightscale#1 arg1 0 16 1 [
                p_disabled   = @(! $atmo#1 arg1)
                p_label      = [#1(? $arg1 "" "Tint scale")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Atmosphere tint scale" "colour color" "atmosphere")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_colour atmolight#1 arg1 [
                p_disabled   = @(! $atmo#1 arg1)
                p_label      = [#1(? $arg1 "" "Colour")]
                p_label_size = $ui_tool_text_size_xs
                p_val_format = i
                p_interval   = $ui_tool_env_param_interval
                p_flags      = $TOOL_COLOUR_ZEROFIX
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Atmosphere colour" "color" "atmosphere")

            uistyle clampx
            uipropchild [uialign 1]
            uistyle righttop
        ]
    ]
]

# ui_tool_env_atmo_disk = [
    result [
        uivlist 0 [
            ui_tool_numinput atmodisksize#1 arg1 0 90 1 [
                p_disabled   = @(! $atmo#1 arg1)
                p_label      = [#1(? $arg1 "" "Size")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Atmosphere disk size" "sun star scale" "atmosphere")

            ui_tool_numinput atmodiskbright#1 arg1 0 16 1 [
                p_disabled   = @(! $atmo#1 arg1)
                p_label      = [#1(? $arg1 "" "Brightness")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Atmosphere disk brightness" "sun star brightness visibility" "atmosphere")

            ui_tool_numinput atmodiskcorona#1 arg1 0 1 0.1 [
                p_disabled   = @(! $atmo#1 arg1)
                p_label      = [#1(? $arg1 "" "Corona")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Atmosphere disk corona" "sun star visibility" "atmosphere")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_colour atmodisk#1 arg1 [
                p_disabled   = @(! $atmo#1 arg1)
                p_label      = [#1(? $arg1 "" "Colour")]
                p_label_size = $ui_tool_text_size_xs
                p_val_format = i
                p_interval   = $ui_tool_env_param_interval
                p_flags      = $TOOL_COLOUR_ZEROFIX
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Atmosphere disk colour" "sun star color" "atmosphere")

            uistyle clampx
            uipropchild [uialign 1]
            uistyle righttop
        ]
    ]
]

# ui_tool_env_fog = [
    result [
        uivlist 0 [
            ui_tool_numinput fog#1 arg1 16 10000024 100 [
                p_label      = [#1(? $arg1 "" "Distance")]
                p_label_size = $ui_tool_text_size_xs
                p_val_format = i
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Fog distance" "thickness" "fog")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_colour fogcolour#1 arg1 [
                p_label      = [#1(? $arg1 "" "Colour")]
                p_label_size = $ui_tool_text_size_xs
                p_val_format = i
                p_interval   = $ui_tool_env_param_interval
                p_flags      = $TOOL_COLOUR_ZEROFIX
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Fog colour" "color" "fog")

            uistyle clampx
            uipropchild [uialign 1]
            uistyle righttop
        ]
    ]
]

# ui_tool_env_fogdome = [
    result [
        uivlist 0 [
            uihlist $ui_tool_elem_space_s [
                ui_tool_checkbox fogdomecap#1 arg1 [
                    p_label_size = $ui_tool_text_size_xs
                    p_label      = "Cap"
                    p_id         = #(tool_get_id)
                ]
                #(tool_env_register_control "Fog dome cap" "shape" "fog")

                ui_tool_checkbox fogdomeclouds#1 arg1 [
                    p_label_size = $ui_tool_text_size_xs
                    p_label      = "Block clouds"
                    p_id         = #(tool_get_id)
                ]
                #(tool_env_register_control "Fog dome block clouds" "" "fog")
            ]

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput fogdomeheight#1 arg1 -1 1 0.1 [
                p_label      = [#1(? $arg1 "" "Height")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Fog dome height" "shape size scale" "fog")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput fogdomemin#1 arg1 0 1 0.1 [
                p_label      = [#1(? $arg1 "" "Min opacity")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Fog dome min opacity" "blending transparency visibility opacity" "fog")

            ui_tool_numinput fogdomemax#1 arg1 0 1 0.1 [
                p_label      = [#1(? $arg1 "" "Max opacity")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Fog dome min opacity" "blending transparency visibility opacity" "fog")

            ui_tool_numinput fogdomeclip#1 arg1 0 1 0.1 [
                p_label      = [#1(? $arg1 "" "Cut-off")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Fog dome cut-ff" "shape visibility clip" "fog")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_colour fogdomecolour#1 arg1 [
                p_label      = [#1(? $arg1 "" "Colour")]
                p_label_size = $ui_tool_text_size_xs
                p_val_format = i
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Fog dome colour" "color" "fog")

            uistyle clampx
            uipropchild [uialign 1]
            uistyle righttop
        ]
    ]
]

# ui_tool_env_sunlight = [
    result [
        uivlist 0 [
            ui_tool_numinput sunlightyaw#1 arg1 0 360 1 [
                p_label      = [#1(? $arg1 "" "Yaw")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Sun light yaw" "rotation rotate position direction" "lighting")

            ui_tool_numinput sunlightpitch#1 arg1 -90 90 1 [
                p_label      = [#1(? $arg1 "" "Pitch")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Sun light pitch" "rotation rotate position direction" "lighting")

            ui_tool_button [
                p_label      = "From camera"
                p_label_size = $ui_tool_text_size_xs
                p_icon       = "<grey>textures/icons/camera"
                p_icon_size  = 0.015
                p_width      = 0.12
                p_on_click   = [
                    sunlightyaw#1 arg1 $camerayaw
                    sunlightpitch#1 arg1 $camerapitch
                ]
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Sun light direction from camera" "rotation rotate position" "lighting")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput sunlightscale#1 arg1 0 16 0.5 [
                p_label      = [#1(? $arg1 "" "Scale")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Sun light scale" "brightness visibility" "lighting")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_colour sunlight#1 arg1 [
                p_label      = [#1(? $arg1 "" "Colour")]
                p_label_size = $ui_tool_text_size_xs
                p_val_format = i
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Sun light colour" "color" "lighting")

            uistyle clampx
            uipropchild [uialign 1]
            uistyle righttop
        ]
    ]
]

# ui_tool_env_ambient = [
    result [
        uivlist 0 [
            ui_tool_colour skylight#1 arg1 [
                p_label      = [#1(? $arg1 "" "Skylight")]
                p_label_size = $ui_tool_text_size_xs
                p_val_format = i
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Sky lighting colour" "color brightness global illumination gi" "lighting")

            ui_tool_colour ambient#1 arg1 [
                p_label      = [#1(? $arg1 "" "Ambient")]
                p_label_size = $ui_tool_text_size_xs
                p_val_format = i
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Ambient lighting colour" "color brightness global illumination gi" "lighting")

            uistyle clampx
            uipropchild [uialign 1]
            uistyle righttop
        ]
    ]
]

# ui_tool_env_hdr = [
    result [
        uivlist 0 [
            ui_tool_numinput hdrbright#1 arg1 0.001 1000 0.5 [
                p_label      = [#1(? $arg1 "" "Brightness")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "HDR brightness" "" "lighting")

            uistyle clampx
            uipropchild [uialign 1]
            uistyle righttop
        ]
    ]
]

# ui_tool_env_flashlight = [
    result [
        uivlist 0 [
            ui_tool_colour flashlightcolour#1 arg1 [
                p_label      = [#1(? $arg1 "" "Colour")]
                p_label_size = $ui_tool_text_size_xs
                p_val_format = i
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Flashlight colour" "" "lighting")

            ui_tool_numinput flashlightlevel#1 arg1 0 0 0.1 [
                p_label      = [#1(? $arg1 "" "Brightness")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Flashlight brightness" "" "lighting")

            ui_tool_numinput flashlightradius#1 arg1 0 0 8 [
                p_label      = [#1(? $arg1 "" "Radius")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Flashlight radius" "" "lighting")

            ui_tool_numinput flashlightspot#1 arg1 0 89 1 [
                p_label      = [#1(? $arg1 "" "Spotlight")]
                p_label_size = $ui_tool_text_size_xs
                p_val_format = i
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Flashlight spotlight area" "" "lighting")

            uistyle clampx
            uipropchild [uialign 1]
            uistyle righttop
        ]
    ]
]

# ui_tool_env_gi = [
    result [
        uivlist 0 [
            ui_tool_numinput giscale#1 arg1 0 1000 0.5 [
                p_label      = [#1(? $arg1 "" "Scale")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Global illumination scale" "brightness" "gi")

            ui_tool_numinput giaoscale#1 arg1 0 1000 1 [
                p_label      = [#1(? $arg1 "" "Skylight")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_tip_simple = "Skylight illumination strength"
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Sky light brightness" "" "gi")

            ui_tool_numinput gidist#1 arg1 0 1024 64 [
                p_label      = [#1(? $arg1 "" "Distance")]
                p_label_size = $ui_tool_text_size_xs
                p_val_format = i
                p_interval   = $ui_tool_env_param_interval
                p_tip_simple = "Bounce distance"
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Global illumination bounce distance" "" "gi")

            uistyle clampx
            uipropchild [uialign 1]
            uistyle righttop
        ]
    ]
]

# ui_tool_env_ao = [
    result [
        uivlist 0 [
            ui_tool_numinput aodark#1 arg1 0.001 1000 0.5 [
                p_label      = [#1(? $arg1 "" "Strength")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Ambient occlusion strength" "darkening shadow ao" "gi")

            ui_tool_numinput aomin#1 arg1 0 1 0.05 [
                p_label      = [#1(? $arg1 "" "Min.")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_tip_simple = "Minimum darkness"
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Ambient occlusion min. brightness" "darkening shadow ao" "gi")

            ui_tool_numinput aosunmin#1 arg1 0 1 0.05 [
                p_disabled   = @(! $aosun#1 arg1)
                p_label      = [#1(? $arg1 "" "Min. in sunlight")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_tip_simple = "Minimum darkness in sunlight"
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Ambient occlusion min. brightness in sunlight" "darkening shadow ao" "gi")

            ui_tool_numinput aoradius#1 arg1 0 256 1 [
                p_label      = [#1(? $arg1 "" "Radius")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Ambient occlusion radius" "darkening shadow ao" "gi")

            ui_tool_numinput aosharp#1 arg1 0.001 1000 0.5 [
                p_label      = [#1(? $arg1 "" "Sharpening")]
                p_label_size = $ui_tool_text_size_xs
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Ambient occlusion sharpening" "ao" "gi")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_checkbox aosun#1 arg1 [
                p_label_size = $ui_tool_text_size_xs
                p_label      = "Sunlight"
                p_interval   = $ui_tool_env_param_interval
                p_tip_simple = "Enable in sunlight"
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Enable ambient occlusion in sunlight" "ao" "gi")

            uistyle clampx
            uipropchild [uialign 1]
            uistyle righttop
        ]
    ]
]

# ui_tool_env_haze = [
    result [
        uivlist 0 [
            ui_tool_checkbox haze#1 arg1 [
                p_label_size = $ui_tool_text_size_xs
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Enable heat haze" "" "haze")

            ui_tool_numinput hazeblend#1 arg1 0 0 0.1 [
                p_label_size = $ui_tool_text_size_xs
                p_label      = [#1(? $arg1 "" "Blend")]
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Heat haze blend" "blending transparency visibility opacity" "haze")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_colour hazecolour#1 arg1 [
                p_label      = [#1(? $arg1 "" "Colour")]
                p_label_size = $ui_tool_text_size_xs
                p_val_format = i
                p_interval   = $ui_tool_env_param_interval
                p_flags      = $TOOL_COLOUR_ZEROFIX
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Heat haze colour" "color" "haze")

            ui_tool_numinput hazecolourmix#1 arg1 0 0 0.1 [
                p_label_size = $ui_tool_text_size_xs
                p_label      = [#1(? $arg1 "" "Colour mix")]
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Heat haze colour mix" "color" "haze")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput hazemindist#1 arg1 0 0 10 [
                p_label_size = $ui_tool_text_size_xs
                p_label      = [#1(? $arg1 "" "Min distance")]
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Heat haze min. distance" "" "haze")

            ui_tool_numinput hazemaxdist#1 arg1 0 0 100 [
                p_label_size = $ui_tool_text_size_xs
                p_label      = [#1(? $arg1 "" "Max distance")]
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Heat haze max. distance" "" "haze")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput hazerefract#1 arg1 0 0 0.5 [
                p_label_size = $ui_tool_text_size_xs
                p_label      = [#1(? $arg1 "" "Refract small")]
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Heat haze low freq. refract" "" "haze")

            ui_tool_numinput hazerefract3#1 arg1 0 0 0.5 [
                p_label_size = $ui_tool_text_size_xs
                p_label      = [#1(? $arg1 "" "Refract medium")]
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Heat haze medium freq. refract" "" "haze")

            ui_tool_numinput hazerefract2#1 arg1 0 0 0.5 [
                p_label_size = $ui_tool_text_size_xs
                p_label      = [#1(? $arg1 "" "Refract large")]
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Heat haze high freq. refract" "" "haze")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput hazescalex#1 arg1 0 0 0.5 [
                p_label_size = $ui_tool_text_size_xs
                p_label      = [#1(? $arg1 "" "Scale X")]
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Heat haze X scale" "size" "haze")

            ui_tool_numinput hazescaley#1 arg1 0 0 0.5 [
                p_label_size = $ui_tool_text_size_xs
                p_label      = [#1(? $arg1 "" "Scale Y")]
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Heat haze Y scale" "size" "haze")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput hazescrollx#1 arg1 0 0 0.5 [
                p_label_size = $ui_tool_text_size_xs
                p_label      = [#1(? $arg1 "" "Scroll X")]
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Heat haze X scroll" "" "haze")

            ui_tool_numinput hazescrolly#1 arg1 0 0 0.5 [
                p_label_size = $ui_tool_text_size_xs
                p_label      = [#1(? $arg1 "" "Scroll Y")]
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Heat haze Y scroll" "" "haze")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_fileselect hazetex#1 arg1 [
                p_file_type = $TOOL_FILE_IMAGE
                p_id        = #(tool_get_id)
            ]
            #(tool_env_register_control "Heat haze texture" "" "haze")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput hazemargin#1 arg1 0 0 1 [
                p_label_size = $ui_tool_text_size_xs
                p_label      = [#1(? $arg1 "" "Margin")]
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Heat haze margin" "" "haze")

            uistyle clampx
            uipropchild [uialign 1]
            uistyle righttop
        ]
    ]
]

# ui_tool_env_wind = [
    result [
        uivlist 0 [
            ui_tool_numinput windinterval#1 arg1 0 0 1 [
                p_label_size = $ui_tool_text_size_xs
                p_label      = [#1(? $arg1 "" "Interval")]
                p_interval   = $ui_tool_env_param_interval
                p_val_format = f
                p_get        = [divf $arg1 1000]
                p_set        = [toint (*f $arg1 1000)]
                p_val_text   = [(concat $arg1 "s")]
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Wind interval" "time timing" "wind")

            ui_tool_numinput windspeed#1 arg1 0 0 0.5 [
                p_label_size = $ui_tool_text_size_xs
                p_label      = [#1(? $arg1 "" "Speed")]
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Wind speed" "strength" "wind")

            ui_tool_numinput windyaw#1 arg1 0 0 1 [
                p_label_size = $ui_tool_text_size_xs
                p_label      = [#1(? $arg1 "" "Direction (yaw)")]
                p_interval   = $ui_tool_env_param_interval
                p_circular   = 1
                p_val_format = i
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Wind direction" "yaw" "wind")

            uifill 0 $ui_tool_elem_space_s

            @@(? $arg1 [] [
                ui_tool_numinput windanimdistbias 0 0 100 [
                    p_label_size = $ui_tool_text_size_xs
                    p_label      = "Anim. cutoff bias"
                    p_interval   = $ui_tool_env_param_interval
                    p_val_format = i
                    p_tip_simple = "Wind animation cutoff distance bias"
                    p_id         = #(tool_get_id)
                ]
                #(tool_env_register_control "Wind yaw anim. cut-off bias" "lod" "wind")
            ])

            uistyle clampx
            uipropchild [uialign 1 -1]
            uistyle righttop
        ]
    ]
]

# ui_tool_env_grass = [
    result [
        uivlist 0 [
            @@(? $arg1 [] [
                ui_tool_numinput grassanimmillis 0 0 1 [
                    p_label_size = $ui_tool_text_size_xs
                    p_label      = "Anim. interval"
                    p_interval   = $ui_tool_env_param_interval
                    p_val_format = f
                    p_get        = [divf $arg1 1000]
                    p_set        = [toint (*f $arg1 1000)]
                    p_val_text   = [(concat $arg1 "s")]
                    p_tip_simple = "Length of a single animation cycle.^nHigher values slow down the animation."
                    p_id         = #(tool_get_id)
                ]
                #(tool_env_register_control "Grass animation interval" "speed wind" "grass")

                ui_tool_numinput grassanimscale 0 0 0.01 [
                    p_label_size = $ui_tool_text_size_xs
                    p_label      = "Anim. scale"
                    p_interval   = $ui_tool_env_param_interval
                    p_val_format = f
                    p_id         = #(tool_get_id)
                ]
                #(tool_env_register_control "Grass animation scale" "strength wind" "grass")

                ui_tool_numinput grassblend 0 0 0.1 [
                    p_label_size = $ui_tool_text_size_xs
                    p_label      = "Blend"
                    p_interval   = $ui_tool_env_param_interval
                    p_val_format = f
                    p_tip_simple = "Used if value not supplied by the texture slot parameters"
                    p_id         = #(tool_get_id)
                ]
                #(tool_env_register_control "Grass blend" "blending transparency visibility opacity" "grass")

                ui_tool_colour grascolour2 [
                    p_label      = "Colour"
                    p_label_size = $ui_tool_text_size_xs
                    p_val_format = i
                    p_interval   = $ui_tool_env_param_interval
                    p_tip_simple = "Used if value not supplied by the texture slot parameters"
                    p_id         = #(tool_get_id)
                ]
                #(tool_env_register_control "Grass colour" "color" "grass")

                ui_tool_numinput grassheight 0 0 1 [
                    p_label_size = $ui_tool_text_size_xs
                    p_label      = "Height"
                    p_interval   = $ui_tool_env_param_interval
                    p_val_format = i
                    p_tip_simple = "Used if value not supplied by the texture slot parameters"
                    p_id         = #(tool_get_id)
                ]
                #(tool_env_register_control "Grass height" "size scale" "grass")

                ui_tool_numinput grassscale 0 0 1 [
                    p_label_size = $ui_tool_text_size_xs
                    p_label      = "Scale"
                    p_interval   = $ui_tool_env_param_interval
                    p_val_format = i
                    p_tip_simple = "Used if value not supplied by the texture slot parameters"
                    p_id         = #(tool_get_id)
                ]
                #(tool_env_register_control "Grass scale" "size" "grass")

                ui_tool_numinput grasstest 0 0 0.01 [
                    p_label_size = $ui_tool_text_size_xs
                    p_label      = "Alpha test"
                    p_interval   = $ui_tool_env_param_interval
                    p_val_format = f
                    p_tip_simple = "Used if value not supplied by the texture slot parameters"
                    p_id         = #(tool_get_id)
                ]
                #(tool_env_register_control "Grass alpha test" "threshold blending transparency visibility opacity" "grass")
            ])

            uistyle clampx
            uipropchild [uialign 1 -1]
            uistyle righttop
        ]
    ]
]

tool_weather_particles = (sublist $PART_NAMES $PART_FIREBALL_LERP (+ 1 (- $PART_LAST $PART_FIREBALL_LERP)))
tool_weather_stains = (concatword "[Discard]" "[Destroy]" "[No Collide]" (sublist $STAIN_NAMES 0 (- $STAIN_MAX 1)))

# ui_tool_env_weather = [
    result [
        uivlist 0 [
            ui_tool_dropdown weatherdroppart#1 arg1 $tool_weather_particles [
                p_label_size = $ui_tool_text_size_xs
                p_label      = [#1(? $arg1 "" "Type")]
                p_id         = #(tool_get_id)
                p_get        = [ - $arg1 $PART_FIREBALL_LERP ]
                p_set        = [ + $arg1 $PART_FIREBALL_LERP ]
            ]
            #(tool_env_register_control "Drop particle" "particle type" "weather")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput weatherdrops#1 arg1 0 0 0.1 [
                p_label_size = $ui_tool_text_size_xs
                p_label      = [#1(? $arg1 "" "Drop rate")]
                p_interval   = $ui_tool_env_param_interval
                p_val_format = f
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Drop rate" "time timing drops per millisecond second" "weather")

            ui_tool_numinput weatherdropfade#1 arg1 0 0 50 [
                p_label_size = $ui_tool_text_size_xs
                p_label      = [#1(? $arg1 "" "Fade time")]
                p_interval   = $ui_tool_env_param_interval
                p_val_format = i
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Fade time" "time timing drops lifetime second" "weather")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput weatherdropgravity#1 arg1 0 0 10 [
                p_label_size = $ui_tool_text_size_xs
                p_label      = [#1(? $arg1 "" "Fall speed")]
                p_interval   = $ui_tool_env_param_interval
                p_val_format = i
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Drop fall speed" "gravity" "weather")

            ui_tool_numinput weatherdropvariance#1 arg1 0 0 0.01 [
                p_label_size = $ui_tool_text_size_xs
                p_label      = [#1(? $arg1 "" "Fall variance")]
                p_interval   = $ui_tool_env_param_interval
                p_val_format = f
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Drop fall variance" "wind jitter" "weather")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_numinput weatherdropsize#1 arg1 0 0 0.1 [
                p_label_size = $ui_tool_text_size_xs
                p_label      = [#1(? $arg1 "" "Drop size")]
                p_interval   = $ui_tool_env_param_interval
                p_val_format = f
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Drop size" "scale" "weather")

            ui_tool_numinput weatherdroplen#1 arg1 0 0 0.1 [
                p_label_size = $ui_tool_text_size_xs
                p_label      = [#1(? $arg1 "" "Tape length")]
                p_interval   = $ui_tool_env_param_interval
                p_val_format = f
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Tape length" "length" "weather")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_colour weatherdropcolour#1 arg1 [
                p_label      = [#1(? $arg1 "" "Colour")]
                p_label_size = $ui_tool_text_size_xs
                p_val_format = i
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
                p_pulsecols  = 1
            ]
            #(tool_env_register_control "Drop colour" "colour color" "weather")

            ui_tool_numinput weatherdropblend#1 arg1 0 0 0.1 [
                p_label_size = $ui_tool_text_size_xs
                p_label      = [#1(? $arg1 "" "Drop opacity")]
                p_interval   = $ui_tool_env_param_interval
                p_val_format = f
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Drop opacity" "transparency blend" "weather")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_colour weatherdrophintcolour#1 arg1 [
                p_label      = [#1(? $arg1 "" "Hint colour")]
                p_label_size = $ui_tool_text_size_xs
                p_val_format = i
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
                p_pulsecols  = 1
            ]
            #(tool_env_register_control "Hint colour" "hint colour color" "weather")

            ui_tool_numinput weatherdrophintblend#1 arg1 0 0 0.1 [
                p_label_size = $ui_tool_text_size_xs
                p_label      = [#1(? $arg1 "" "Hint blend")]
                p_interval   = $ui_tool_env_param_interval
                p_val_format = f
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Hint blend" "hint transparency blend" "weather")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_colour weatherdropenvcolour#1 arg1 [
                p_label      = [#1(? $arg1 "" "Envmap colour")]
                p_label_size = $ui_tool_text_size_xs
                p_val_format = i
                p_interval   = $ui_tool_env_param_interval
                p_id         = #(tool_get_id)
                p_pulsecols  = 1
            ]
            #(tool_env_register_control "Envmap colour" "envmap colour color" "weather")

            ui_tool_numinput weatherdropenvblend#1 arg1 0 0 0.1 [
                p_label_size = $ui_tool_text_size_xs
                p_label      = [#1(? $arg1 "" "Envmap blend")]
                p_interval   = $ui_tool_env_param_interval
                p_val_format = f
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Envmap blend" "envmap transparency blend" "weather")

            uifill 0 $ui_tool_elem_space_s

            ui_tool_dropdown weatherdropcollide#1 arg1 $tool_weather_stains [
                p_label_size = $ui_tool_text_size_xs
                p_label      = [#1(? $arg1 "" "Collide")]
                p_id         = #(tool_get_id)
                p_get        = [ + $arg1 2 ]
                p_set        = [ - $arg1 2 ]
            ]
            #(tool_env_register_control "Collide type" "collide stain" "weather")

            uistyle clampx
            uipropchild [uialign 1 -1]
            uistyle righttop
        ]
    ]
]

// 1:<ui> 2:<label>
ui_tool_env_params = [
    result [
        ui_tool_env_param_group [@@arg2] [
            @@($arg1)
            @@($arg1 alt)
        ]
    ]
]

# ui_tool_env_table = [
    result [
        ui_tool_vscrollarea [
            uitable $ui_tool_elem_space_l $ui_tool_elem_space_l [
                uistyle clampx
                uitableheader [
                    uifill
                    uicolourtext (at $MPV_NAMES 1) (? (<= $forcemapvariant 1) $ui_tool_accent_colour $ui_tool_dark_accent_colour) $ui_tool_text_size_s
                    uicolourtext (at $MPV_NAMES 2) (? (= $forcemapvariant 2) $ui_tool_accent_colour $ui_tool_dark_accent_colour) $ui_tool_text_size_s
                ]

                uiline $ui_tool_dark_accent_colour 0 0 [ uistyle clampx ]

                #1 arg1
            ]
        ] [
            p_height = 0.6
            p_id     = #(tool_get_id)
        ]
    ]
]

ui_tool_env_tab_skybox = [
    @(ui_tool_env_table [
        @(ui_tool_env_params ui_tool_env_skybox "Skybox")
        @(ui_tool_env_params ui_tool_env_skybg "Background")
    ])
]

ui_tool_env_tab_cloudlayer = [
    @(ui_tool_env_table [
        @(ui_tool_env_params ui_tool_env_cloudlayer "Layer #1")
        @(ui_tool_env_params ui_tool_env_envlayer "Layer #2")
    ])
]

ui_tool_env_tab_cloudcylinder = [
    @(ui_tool_env_table [
        @(ui_tool_env_params ui_tool_env_cloudcylinder "Layer #1")
        @(ui_tool_env_params ui_tool_env_envcylinder "Layer #2")
    ])
]

ui_tool_env_tab_cloudbox = [
    @(ui_tool_env_table [
        @(ui_tool_env_params ui_tool_env_cloudbox "Cloud box")
    ])
]

ui_tool_env_tab_atmosphere = [
    @(ui_tool_env_table [
        @(ui_tool_env_params ui_tool_env_atmo "Atmosphere")
        @(ui_tool_env_params ui_tool_env_atmo_disk "Disk")
    ])
]

ui_tool_env_tab_fog = [
    @(ui_tool_env_table [
        @(ui_tool_env_params ui_tool_env_fog "Fog")
        @(ui_tool_env_params ui_tool_env_fogdome "Dome")
    ])
]

ui_tool_env_tab_lighting = [
    @(ui_tool_env_table [
        @(ui_tool_env_params ui_tool_env_sunlight "Sunlight")
        @(ui_tool_env_params ui_tool_env_ambient "Ambient")
        @(ui_tool_env_params ui_tool_env_hdr "HDR")
        @(ui_tool_env_params ui_tool_env_flashlight "Flashlight")
    ])
]

ui_tool_env_tab_gi = [
    @(ui_tool_env_table [
        @(ui_tool_env_params ui_tool_env_gi "Global illumination")
        @(ui_tool_env_params ui_tool_env_ao "Ambient occlusion")
    ])
]

ui_tool_env_tab_haze = [
    @(ui_tool_env_table [
        @(ui_tool_env_params ui_tool_env_haze "Haze")
    ])
]

ui_tool_env_tab_wind = [
    @(ui_tool_env_table [
        @(ui_tool_env_params ui_tool_env_wind "Wind")
    ])
]

ui_tool_env_tab_grass = [
    uistyle clampx
    @(ui_tool_env_grass)
]

ui_tool_env_tab_weather = [
    @(ui_tool_env_table [
        @(ui_tool_env_params ui_tool_env_weather "Weather")
    ])
]

tool_env_sound_sel_env              = ""
tool_env_sound_sel_env_new_conflict = 0

ui_tool_env_sound_new_env = [
    if $toolpanel_this_isinit [
        tool_env_sound_sel_env_new          = ""
        tool_env_sound_sel_env_new_conflict = 0
    ]

    uispace $ui_tool_elem_space_l $ui_tool_elem_space_l [
        uistyle clampx

        uivlist $ui_tool_elem_space_l [
            uistyle clampx

            ui_tool_textinput tool_env_sound_sel_env_new 32 [
                p_label     = "Environment name"
                p_immediate = 0
                p_on_change = [
                    tool_env_sound_sel_env_new_conflict = (
                        listhas (tool_env_list_soundenvs) $tool_env_sound_sel_env_new
                    )
                ]
            ]

            if $tool_env_sound_sel_env_new_conflict [
                uicolourtext "Name already exists!" $ui_tool_warn_colour $ui_tool_text_size_s
            ]

            ui_tool_button [
                p_label    = "Add"
                p_on_click = [
                    defsoundenv $tool_env_sound_sel_env_new
                    tool_env_sound_sel_env = $tool_env_sound_sel_env_new
                    toolpanel_close_this
                ]
                p_width    = 0.2
                p_disabled = $tool_env_sound_sel_env_new_conflict
            ]
        ]
    ]
]

ui_tool_env_sound_rename_env = [
    if $toolpanel_this_isinit [
        tool_env_sound_sel_env_new          = $tool_env_sound_sel_env
        tool_env_sound_sel_env_new_conflict = 0
    ]

    uispace $ui_tool_elem_space_l $ui_tool_elem_space_l [
        uistyle clampx

        uivlist $ui_tool_elem_space_l [
            uistyle clampx

            ui_tool_textinput tool_env_sound_sel_env_new 32 [
                p_label     = "Environment name"
                p_immediate = 0
                p_on_change = [
                    tool_env_sound_sel_env_new_conflict = (
                        listhas (tool_env_list_soundenvs) $tool_env_sound_sel_env_new
                    )
                ]
            ]

            if $tool_env_sound_sel_env_new_conflict [
                uicolourtext "Name already exists!" $ui_tool_warn_colour $ui_tool_text_size_s
            ]

            ui_tool_button [
                p_label    = "Rename"
                p_on_click = [
                    renamesoundenv $tool_env_sound_sel_env $tool_env_sound_sel_env_new
                    tool_env_sound_sel_env = $tool_env_sound_sel_env_new
                    toolpanel_close_this
                ]
                p_width    = 0.2
                p_disabled = $tool_env_sound_sel_env_new_conflict
            ]
        ]
    ]
]

// 1:<param> 2:<type> 3:<step> 4:<label> 5:<tip>
ui_env_get_sound_env_param_input = [
    local _var
    _var = [tool_env_sound_env_param_@arg1]
    $_var = (getsoundenvprop $tool_env_sound_sel_env $arg1)

    ui_tool_numinput $_var (
        getsoundenvpropmin $tool_env_sound_sel_env $arg1
    ) (getsoundenvpropmax $tool_env_sound_sel_env $arg1) $arg3 [
        p_label      = [@@arg4]
        p_tip_simple = [@@arg5]
        p_immediate  = 0
        p_val_format = $arg2
        p_reset_val  = [@@(getsoundenvpropdef $tool_env_sound_sel_env $arg1)]
        p_label_size = $ui_tool_text_size_xs_unscaled
        p_on_change  = [
            defsoundenv $tool_env_sound_sel_env [
                soundenvprop@@@arg2 @@@arg1 $@@@_var
            ] 1
        ]
    ]
]

tool_env_soundfile = ""

# ui_tool_env_tab_sound = [
    if $toolpanel_this_isinit [
        tool_env_sound_sel_env = ""
    ]

    uistyle clampx

    uivlist $ui_tool_elem_space_l [
        uistyle clampx

        uitext "Map sounds:" $ui_tool_text_size_s

        uicolour $ui_tool_dark_colour 0 0 [
            uistyle clampx

            ui_tool_vscrollarea [
                uigrid 2 0.005 0 [
                    uialign -1

                    loop i (mapsoundinfo -1) [
                        local _sound_name
                        _sound_name = (mapsoundinfo $i)

                        ui_tool_button [
                            p_noonline   = 1
                            p_icon       = "<grey>textures/icons/edit/del"
                            p_icon_size  = 0.015
                            p_pad        = 0
                            p_tip_simple = "Remove sound"
                            p_on_click   = [
                                remmapsound [@@@_sound_name]
                            ]
                        ]

                        uitext $_sound_name $ui_tool_text_size_xs_unscaled
                        uiprev [uialign -1]
                    ]
                ]
            ] [
                p_id = #(tool_get_id)
            ]
        ]

        uihlist 0 [
            uistyle clampx

            uihlist 0 [
                uialign -1

                tool_env_soundfile = ""

                ui_tool_fileselect tool_env_soundfile [
                    p_noonline     = 1
                    p_dir          = "sounds"
                    p_file_type    = $TOOL_FILE_SOUND
                    p_columns      = 4
                    p_sel_size     = 0.105
                    p_show_value   = 0
                    p_picker_width = 0.48
                    p_on_change    = [
                        mapsound $tool_env_soundfile
                    ]
                    p_browse_button_props = [
                        #ui_tool_square_button_s
                        p_icon       = "<grey>textures/icons/edit/add"
                        p_tip_simple = "Add a sound slot"
                    ]
                    p_id           = #(tool_get_id)
                ]
                #(tool_env_register_control "Add a sound slot" "definition" "sound")

                ui_tool_button [
                    #ui_tool_square_button_s
                    p_noonline   = 1
                    p_icon       = "<grey>textures/icons/edit/del"
                    p_tip_simple = "Removes all map sound slots"
                    p_on_click   = [
                        tool_confirm_prompt "Do you want to remove all map sound slots?" [
                            clearmapsounds
                        ] [
                            p_noundo_warn = 1
                        ]
                    ]
                    p_id         = #(tool_get_id)
                ]
            ]
            #(tool_env_register_control "Remove all map sound slots" "delete clear" "sound")

            ui_tool_button [
                p_noonline   = 1
                p_label      = "Load default definitions"
                p_label_size = $ui_tool_text_size_s_unscaled
                p_tip_simple = "Clears and reloads default sound definitions."
                p_on_click   = [
                    clearmapsounds
                    exec "config/map/sounds.cfg"
                ]
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Load default sounds" "" "sound")
            uiprev [uialign 1]
        ]

        #ui_tool_divider

        uitext "Environments:" $ui_tool_text_size_s

        ui_tool_numinput mapsoundfadespeed 0.25 10 0.25 [
            p_label      = "Fade time"
            p_val_format = f
            p_get        = [ divf 0.001 $arg1 ]
            p_set        = [ divf 0.001 $arg1 ]
            p_val_text   = [ concatword $arg1 "s" ]
            p_immediate  = 0
            p_id         = #(tool_get_id)
        ]
        #(tool_env_register_control "Sound environment fade speed" "timing time" "sound")

        uicolour $ui_tool_dark_colour 0 0 [
            uistyle clampx

            ui_tool_vscrollarea [
                uigrid 2 0 0 [
                    uialign -1

                    loop i (soundenvinfo -1) [
                        local _env_name _text_col
                        _env_name = (soundenvinfo $i)
                        _text_col = (? (=s $tool_env_sound_sel_env $_env_name) $ui_tool_accent_colour $ui_tool_dark_accent_colour)

                        ui_tool_button [
                            p_noonline   = 1
                            p_icon       = "<grey>textures/icons/edit/del"
                            p_icon_size  = 0.015
                            p_pad        = 0
                            p_tip_simple = "Remove environment"
                            p_on_click   = [
                                remsoundenv [@@@_env_name]
                                if (=s [@@@_env_name] $tool_env_sound_sel_env) [
                                    tool_env_sound_sel_env = ""
                                ]
                            ]
                        ]

                        ui_tool_button [
                            p_noonline      = 1
                            p_label         = [@@_env_name]
                            p_label_align   = -1
                            p_label_size    = $ui_tool_text_size_xs_unscaled
                            p_width         = 0.32
                            p_colour        = $_text_col
                            p_tip_simple    = "Select environment"
                            p_on_click      = [
                                tool_env_sound_sel_env = [@@@_env_name]
                            ]
                        ]
                    ]
                ]
            ] [
                p_id = #(tool_get_id)
            ]
        ]

        uihlist 0 [
            uistyle clampx

            uihlist 0 [
                ui_tool_button [
                    #ui_tool_square_button_s
                    p_noonline   = 1
                    p_icon       = "<grey>textures/icons/edit/new"
                    p_tip_simple = "New"
                    p_on_click   = [
                        toolpanel_open tool_env_sound_new_env popup [
                            p_position = [@@(uicursorpos)]
                            p_width    = 0.5
                        ]
                    ]
                ]

                ui_tool_button [
                    #ui_tool_square_button_s
                    p_noonline   = 1
                    p_icon       = "<grey>textures/icons/edit/copy"
                    p_tip_simple = "Duplicate"
                    p_disabled   = (=s $tool_env_sound_sel_env "")
                    p_on_click   = [
                        local _name
                        _name = (tool_get_name $tool_env_sound_sel_env (tool_env_list_soundenvs) " #")
                        dupsoundenv $_name $tool_env_sound_sel_env
                    ]
                ]

                ui_tool_button [
                    #ui_tool_square_button_s
                    p_noonline   = 1
                    p_icon       = "<grey>textures/icons/edit/name"
                    p_tip_simple = "Rename"
                    p_disabled   = (=s $tool_env_sound_sel_env "")
                    p_on_click   = [
                        toolpanel_open tool_env_sound_rename_env popup [
                            p_position = [@@(uicursorpos)]
                            p_width    = 0.5
                        ]
                    ]
                ]
            ]
            uiprev [uialign -1]

            ui_tool_button [
                p_noonline   = 1
                p_label      = "Load default definitions"
                p_label_size = $ui_tool_text_size_s_unscaled
                p_tip_simple = "Reloads default sound environment definitions.^nKeeps custom definitions intact."
                p_on_click   = [
                    exec "config/map/soundenvs.cfg"
                ]
                p_id         = #(tool_get_id)
            ]
            #(tool_env_register_control "Load default sound environments" "" "sound")
            uiprev [uialign 1]
        ]
    ]
    toolpanel_calc_dyn_content (+f $uilasthprev $ui_tool_elem_space_l)

    if (!=s $tool_env_sound_sel_env "") [
        ui_tool_vscrollarea [
            uivlist 0 [
                uistyle clampx

                ui_tool_group "Gain" [
                    ui_env_get_sound_env_param_input gain                  f 0.1  "Total"                  "Total gain of all components of the reverb^n(early reverb, late reverb and echo)"
                    ui_env_get_sound_env_param_input gainhf                f 0.1  "High frequency"         "High frequency gain of all components of the reverb^n(early reverb, late reverb and echo)"
                    ui_env_get_sound_env_param_input gainlf                f 0.1  "Low frequency"          "Low frequency gain of all components of the reverb^n(early reverb, late reverb and echo)"

                    uifill 0 $ui_tool_elem_space_l

                    ui_env_get_sound_env_param_input air_absorbtion_gainhf f 0.01 "High freq. air absorb." "Distasnce-dependent attenuation of high frequencies"
                    ui_env_get_sound_env_param_input room_rolloff_factor   f 0.1  "Room attenuation"       "Attenuation of reverb based on the distance to the source of the sound"
                ]

                #ui_tool_divider

                ui_tool_group "Decay" [
                    ui_env_get_sound_env_param_input diffusion             f 0.1  "Diffusion"              "Echo density in the reverb decay.^nLess diffusion produces more 'grainy' results."
                    ui_env_get_sound_env_param_input decay_time            f 0.1  "Time (s)"               "Reverb decay time in seconds"
                    ui_env_get_sound_env_param_input decay_hfratio         f 0.1  "High frequency ratio"   "Decay time multiplier for high frequencies"
                    ui_env_get_sound_env_param_input decay_lfratio         f 0.1  "Low frequency ratio"    "Decay time multiplier for low frequencies"
                ]

                #ui_tool_divider

                ui_tool_group "Early reflections" [
                    ui_env_get_sound_env_param_input reflections_gain      f 0.1  "Gain"                   "Amount of initial reflections.^nIncrease this value to simulate more narrow spaces."
                    ui_env_get_sound_env_param_input reflections_delay     f 0.01 "Delay (s)"              "Delay time of the initial reflections in seconds"
                ]

                #ui_tool_divider

                ui_tool_group "Late reverb" [
                    ui_env_get_sound_env_param_input density               f 0.1  "Density"                "Less density results in more coloration"
                    ui_env_get_sound_env_param_input late_gain             f 0.1  "Gain"                   "Amount of late reverb"
                    ui_env_get_sound_env_param_input late_delay            f 0.01 "Delay (s)"              "Delay time of the late reverb in seconds"
                ]

                #ui_tool_divider

                ui_tool_group "Echo" [
                    ui_env_get_sound_env_param_input echo_time             f 0.1  "Time (s)"               "Repetition interval in seconds between echos"
                    ui_env_get_sound_env_param_input echo_depth            f 0.1  "Depth"                  "Determines how long echo will persist in the reverb tail"
                ]

                #ui_tool_divider

                ui_tool_group "Modulation" [
                    ui_env_get_sound_env_param_input mod_time              f 0.1  "Time (s)"               "Reverb vibrato modulation cycle time in seconds"
                    ui_env_get_sound_env_param_input mod_depth             f 0.1  "Depth"                  "Strength of modulation"
                ]

                #ui_tool_divider

                ui_tool_group "Filter" [
                    ui_env_get_sound_env_param_input hfref                 f 10   "High frequency (Hz)"    "Determines the cut-off of high frequency content"
                    ui_env_get_sound_env_param_input lfref                 f 10   "Low frequency (Hz)"     "Determines the cut-off of low frequency content"
                ]
            ]

            uipropchild [uialign -1]
        ] [
            p_height = $toolpanel_dyn_content_h
            p_id     = #(tool_get_id)
        ]
    ]
]

tool_env_template_wizard = 0
tool_env_template_sel = 0

ui_tool_env_template = [
    ui_tool_dropdown tool_env_template_sel $tool_template_env_names [
        p_label = "Template"
        p_label_size = $ui_tool_text_size_xs
        p_on_change = [
            tool_template_env_name = (at $tool_templates_env $tool_env_template_sel)
        ]
    ]

    ui_tool_switch tool_template_env_mode [
        p_label = "Mode"
        p_label_size = $ui_tool_text_size_xs
        p_options = ["Day" "Night"]
        p_get = [=s $arg1 night]
        p_set = [? $arg1 night day]
    ]

    ui_tool_numinput tool_template_env_time 0 1 0.1 [
        p_label = "Time"
        p_label_size = $ui_tool_text_size_xs
    ]

    ui_tool_numinput tool_template_env_cloudiness 0 1 0.25 [
        p_label = "Clouds"
        p_label_size = $ui_tool_text_size_xs
    ]

    uifill 0 $ui_tool_elem_space_xl

    uihlist $ui_tool_elem_space_s [
        uistyle clampx

        uitext "Apply as:" $ui_tool_text_size_s
        uiprev [uialign -1]

        uihlist $ui_tool_elem_space_s [
            ui_tool_button [
                p_label = (at $MPV_NAMES 1)
                p_width = $ui_tool_button_width_s_unscaled
                p_on_click = [
                    tool_template_env_alt = []
                    tool_template_env_apply
                ]
            ]

            ui_tool_button [
                p_label = (at $MPV_NAMES 2)
                p_width = $ui_tool_button_width_s_unscaled
                p_on_click = [
                    tool_template_env_alt = alt
                    tool_template_env_apply
                ]
            ]
        ]
        uiprev [uialign 1]
    ]

    uifill 0 $ui_tool_elem_space_l
    uiline $ui_tool_dark_accent_colour 0 0 [ uistyle clampx ]
    uifill 0 $ui_tool_elem_space_l

    ui_tool_button [
        p_label = "Close"
        p_width = 0.1
        p_on_click = [
            tool_env_template_wizard = 0
        ]
    ]
    uiprev [uistyle clampx]
]

# ui_tool_env_view = [
    ui_tool_button [
        p_label    = "Templates"
        p_width    = 0.1
        p_on_click = [
            tool_env_template_wizard = 1
        ]
        p_id       = #(tool_get_id)
    ]
    #(tool_env_register_control "Environment templates" "skybox atmosphere clouds lighting fog" "")
    uiprev [uialign 1]
    toolpanel_calc_dyn_content (+f $uilasthprev $ui_tool_elem_space_m)

    ui_tool_vtabs tool_env_tabs [
        "<grey>textures/icons/edit/skybox"
        "<grey>textures/icons/edit/cloud"
        "<grey>textures/icons/edit/cloudbox"
        "<grey>textures/icons/edit/cloudcyl"
        "<grey>textures/icons/edit/atmo"
        "<grey>textures/icons/edit/fog"
        "<grey>textures/icons/edit/light"
        "<grey>textures/icons/edit/gi"
        "<grey>textures/icons/edit/haze"
        "<grey>textures/icons/edit/wind"
        "<grey>textures/icons/edit/grass"
        "<grey>textures/icons/edit/sound"
        "<grey>textures/icons/bleed"
    ] [
        "Skybox"
        "Cloud layers"
        "Cloud box"
        "Cloud cylinders"
        "Atmosphere"
        "Fog"
        "Lighting"
        "Global illumination"
        "Haze"
        "Wind"
        "Grass"
        "Sound"
        "Weather"
    ] [
        ui_tool_env_tab_skybox
        ui_tool_env_tab_cloudlayer
        ui_tool_env_tab_cloudbox
        ui_tool_env_tab_cloudcylinder
        ui_tool_env_tab_atmosphere
        ui_tool_env_tab_fog
        ui_tool_env_tab_lighting
        ui_tool_env_tab_gi
        ui_tool_env_tab_haze
        ui_tool_env_tab_wind
        ui_tool_env_tab_grass
        ui_tool_env_tab_sound
        ui_tool_env_tab_weather
    ] [
        p_calc_dyn_content = 1
    ]
]

# ui_tool_env = [
    uivlist $ui_tool_elem_space_m [
        uistyle clampx

        if $tool_env_template_wizard [
            #ui_tool_env_template
        ] [
            #ui_tool_env_view
        ]
    ]
]
