//for settings ui (internal temp vars)
ui_settings_tab = 0

//for binds ui (internal temp vars)
ui_binds_current_key = ""
ui_binds_entry_normal = ""
ui_binds_entry_edit = ""
ui_binds_entry_spectator = ""
ui_binds_entry_wait = ""

//persistent string for keyboard layout type (as defined in keyboards.cfg)
defsvarp keyboardlayout "pc104"

//persistent ints for ao and vol settings
defvarp vollevel 1 2 4 [vollevels]
defvarp aolevel 1 2 4 [aolevels]

defvarp advancedaa 0 0 1

defvarp aalevel 1 2 6 [aalevels]
// *** tooltips ***
//settings
//graphics
ui_tip_settings_smsize = [uitextleft "Shadow map resolution determines fineness of light and shadow;^nmost important setting in overall performance." $ui_texttip]
ui_tip_settings_smfilter = [uitextleft "Shadow map filtering fixes and smooths artifacts in the shadow map." $ui_texttip]
ui_tip_settings_rhtaps = [uitextleft "Global illumination illuminates surfaces from reflected light off of walls,^nfloors, and ceilings (Recommended to have this ON unless necessary)." $ui_texttip]
ui_tip_settings_aotaps = [uitextleft "Ambient occlusion darkens corners that would recieve less global^nillumination because of their lack of access to ambient light." $ui_texttip]
ui_tip_settings_volsteps = [uitextleft "Volumetric lighting (when enabled at the discretion of the mapper)^nfills open space with light, as if there is dust to scatter light." $ui_texttip]
ui_tip_settings_bloomsize = [uitextleft "Bloom (light spillover from bright objects on screen) mimics^nsome of the global illumination produced by bright areas" $ui_texttip]
ui_tip_settings_waterreflect = [uitext "Toggles screenspace reflections on water." $ui_texttip]
ui_tip_settings_caustics = [uitextleft "Toggles patches of light and dark underwater as a result of the water surface's^ntendency to randomly focus light like a lens as it moves." $ui_texttip]
ui_tip_settings_texreduce = [uitextleft "Determines resolution of textures in level geometry." $ui_texttip]
ui_tip_settings_envmapsize = [uitextleft "Determines resolution of environment maps for reflection effects." $ui_texttip]
ui_tip_settings_particlewind = [uitextleft "Toggles particle movement with wind sources, including explosions and map wind sources." $ui_texttip]
ui_tip_settings_softparticles = [uitextleft "Toggles smooth boundaries for particles; especially visible on weapons' halo effects." $ui_texttip]
ui_tip_settings_stainfade = [uitextleft "Stains, like blood stains after frags or weapon bullet holes,^nare temporary to save performance." $ui_texttip]
ui_tip_settings_grassdist = [uitextleft "Determines distance at which grass is rendered." $ui_texttip]
ui_tip_settings_mapeffects = [uitextleft "Certain lights and mapmodels may be designated non-essential^nor optional and can be disabled to save performance." $ui_texttip]
//display
ui_tip_settings_gscale = [uitextleft "Scale of engine's rendering (leaves UIs and the HUD at native resolution)" $ui_texttip]
ui_tip_settings_fullscreen = [uitextleft "Toggles running the game full screen (as opposed to windowed mode)" $ui_texttip]
ui_tip_settings_aniso = [uitextleft "Toggles filtering of anisotropic (ugly aliasing due to limited resolution rasterization) artifacts" $ui_texttip]
ui_tip_settings_bilinear = [uitextleft "Toggles bilinear filtering of textures (including text)" $ui_texttip]
ui_tip_settings_trilinear = [uitextleft "Toggles trilinear filtering of textures (including text)" $ui_texttip]
ui_tip_settings_advancedaa = [uitextleft "Toggles simple and advanced antialiasing settings.^n Most users should not need to enable advanced AA settings." $ui_texttip]
ui_tip_settings_smaa = [uitextleft "Subpixel Morphological antialiasing is a postprocessing antialiasing^nthat attempts to smooth edges in the final image" $ui_texttip]
ui_tip_settings_tqaa = [uitextleft "Temporal Quincunx antialiasing uses the previous frames to smooth out the scene" $ui_texttip]
ui_tip_settings_fxaa = [uitextleft "Fast Approximate antialiasing reduces aliasing artifacts^nby applying a uniform blur to everything" $ui_texttip]
ui_tip_settings_msaa = [uitextleft "Multisample antialiasing reduces aliasing artifacts^nby sampling edges multiple times" $ui_texttip]
ui_tip_settings_aalevel = [uitextleft "Sets the antialiasing quality for the game, using the most practical and recommended AA levels." $ui_texttip]
ui_tip_settings_gamma = [uitextleft "Sets the luminance curve for the engine to render to" $ui_texttip]
ui_tip_settings_maxfps = [uitextleft "Sets the maximum framerate the game can output frames at.^nMost typical unspecialized monitors are limited to 60 FPS^n(so setting this very high will have no actual effect)" $ui_texttip]
ui_tip_settings_vsync = [uitextleft "Toggles syncing the framerate to the monitor's refresh rate (often 60 FPS)" $ui_texttip]
//audio
ui_tip_settings_mastervol = [uitextleft "Audio volume for the entire game, including game sound FX,^nmusic, and menu sounds" $ui_texttip]
ui_tip_settings_soundvol = [uitextleft "Audio volume for the game's sound effects, such as weapon^nand level sounds" $ui_texttip]
ui_tip_settings_musicvol = [uitextleft "Audio volume for the game's music, which plays in the background" $ui_texttip]
ui_tip_settings_musictype = [uitextleft "Maps that have a default soundtrack can be either enforced or overriden with random music" $ui_texttip]
//gameplay
ui_tip_settings_fullbrightmodels = [uitextleft "Player models' brightness can be increased for better visibility" $ui_texttip]
ui_tip_settings_playerghostblend = [uitextleft "Other players' models in race mode's opacity" $ui_texttip]
ui_tip_settings_firstpersonfov = [uitextleft "Ingame field of view in first person mode" $ui_texttip]
ui_tip_settings_thirdpersonfov = [uitextleft "Ingame field of view in third person mode" $ui_texttip]
ui_tip_settings_specfov = [uitextleft "Field of view when spectating a match" $ui_texttip]
ui_tip_settings_editfov = [uitextleft "Field of view when in edit mode" $ui_texttip]
ui_tip_settings_weapautoreload = [uitextleft "Sets when automatic reloading is carried out by the game for you.^n Higher levels (e.g. whenever unscoped) are additional tiers and^ninclude all lower levels (^"when unscoped^" includes ^"whenever^nweapon loads stepwise^" and ^"whenever empty^")" $ui_texttip]
ui_tip_settings_weapautoswitch = [uitextleft "Toggles automatically switching weapons if your current one is out of ammo" $ui_texttip]
ui_tip_settings_firstpersonbob = [uitextleft "Toggles camera bob (up & down movement) in first person mode" $ui_texttip]
ui_tip_settings_firstpersonsway = [uitextleft "Toggles camera sway (side to side movement) in first person mode" $ui_texttip]
//controls
ui_tip_settings_sensitivity = [uitextleft "Sets the ratio between camera movement and mouse movement ingame" $ui_texttip]
ui_tip_settings_mousesensitivity = [uitextleft "Sets the ratio between cursor movement and mouse movement for menus" $ui_texttip]
ui_tip_settings_zoomsensitivity = [uitextleft "Sets the sensitivity scale for when zoomed in as opposed to normal gameplay" $ui_texttip]
ui_tip_settings_mouseinvert = [uitextleft "Toggles inversion of the mouse's y-axis (up/down)" $ui_texttip]
ui_tip_settings_keybinds = [uitextleft "Customize or modify key bindings" $ui_texttip]
//user interface
ui_tip_settings_showfps = [uitextleft "Show framerate with the following information readouts:^n0: off^n1: Average framerate^n2: Average framerate and maximum/minimum as offset^n3: Average framerate and range (Min to Max)^n4: Average framerate and average and worst frametime" $ui_texttip]
ui_tip_settings_showstats = [uitextleft "Show information about the map's geometry counts:^n0: off^n1: Edit mode only^n2: All modes" $ui_texttip]
ui_tip_settings_showtimestyle = [uitextleft "Format the remaining time left in the game:^n0: seconds only, to tenths place^n1: minutes and seconds, to thousandths place^n2: minutes and seconds, to tenths place ^n3: minutes and seconds, no decimal^n4: minutes and seconds, postfixed with 'm' and 's'" $ui_texttip]
ui_tip_settings_crosshairweapons = [uitextleft "Display weapon specific crosshairs:^n0: Same crosshair for all weapons^n1: Weapon specific crosshairs^n2: Weapon specific crosshairs with weapon colours applied" $ui_texttip]
ui_tip_settings_showrealtime = [uitextleft "Toggles display of actual local time, in 24h format" $ui_texttip]
ui_tip_settings_showhud = [uitextleft "Toggles display of the entire heads-up display, including status and crosshair info" $ui_texttip]
ui_tip_settings_showminimap = [uitextleft "Toggles HUD display of the minimap" $ui_texttip]
ui_tip_settings_showmovecount = [uitextleft "Toggles HUD display of the number of parkour moves remaining" $ui_texttip]
ui_tip_settings_showweight = [uitextleft "Toggles HUD display of the current player weight" $ui_texttip]
ui_tip_settings_showvelocity = [uitextleft "Toggles HUD display of the current speed" $ui_texttip]
ui_tip_settings_timer = [uitextleft "Toggles HUD display of engine performance debug information" $ui_texttip]

//volumetric lighting levels (used for vol uiselect)
vollevels = [
    caseif (= $vollevel 1) [
        volsteps 12
        volbilateral 0
        volreduce 2
        volprefilter .1
    ] (= $vollevel 2) [
        volsteps 32
        volbilateral 1
        volreduce 1
        volprefilter .01
    ] (= $vollevel 3) [
        volsteps 64
        volbilateral 2
        volreduce 1
        volprefilter .01
    ] (= $vollevel 4) [
        volsteps 64
        volbilateral 3
        volreduce 0
        volprefilter .01
    ]
]
//ambient occlusion levels (used for AO uiselect)
aolevels = [
    caseif (= $aolevel 1) [
        aotaps 5
        aoreduce 2
        aoiter 0
        aobilateral 1
    ] (= $aolevel 2) [
        aotaps 12
        aoreduce 1
        aoiter 0
        aobilateral 3
    ] (= $aolevel 3) [
        aotaps 12
        aoreduce 1
        aoiter 4
        aobilateral 10
    ] (= $aolevel 4) [
        aotaps 12
        aoreduce 0
        aoiter 4
        aobilateral 10
    ]
]

aalevels = [
    caseif (= $aalevel 1) [
        fxaa 0
        fxaaquality 0
        tqaa 0
        smaa 0
        smaaquality 0
        msaa 0
    ] (= $aalevel 2) [
        fxaa 1
        fxaaquality 0
        tqaa 0
        smaa 0
        smaaquality 0
        msaa 0
    ] (= $aalevel 3) [
        fxaa 0
        fxaaquality 0
        tqaa 1
        smaa 0
        smaaquality 0
        msaa 0
    ] (= $aalevel 4) [
        fxaa 0
        fxaaquality 0
        tqaa 0
        smaa 1
        smaaquality 0
        msaa 0
    ] (= $aalevel 5) [
        fxaa 0
        fxaaquality 0
        tqaa 1
        smaa 1
        smaaquality 3
        msaa 0
    ] (= $aalevel 6) [
        fxaa 0
        fxaaquality 0
        tqaa 0
        smaa 0
        smaaquality 0
        msaa 16
    ]
]

//This is the main settings menu as seen from the main menu.
uimenu "settings" "Settings" "textures/icons/settings" [
    hidechanges 1
    uihlist 0 [
        uiclamp 1 1 1 1
        // side tab, in settings menu
        uivtab (+f $ui_slidersize 0.48) 0.4 $ui_tabw $ui_tabh ui_settings_tab [
            0 "Graphics"        []
            1 "Display"         []
            2 "Audio"           []
            3 "Gameplay"        []
            4 "Controls"        []
            5 "User Interface"  []
            6 "Autoexec"        []
        ] [
            uiscroll 0.48 0.4 [
                uialign -1 0
                uifill 0.48 0.4 [
                    uialign 0 -1
                    uipad $ui_padbutton $ui_padbutton $ui_padbutton $ui_padbutton [
                        uialign 0 -1
                        uiclamp 1 1
                        uitable 0 $ui_padsmall [
                            uialign -1 -1
                            uiclamp 1 1
                            case $ui_settings_tab 0 [ // Graphics Tab
                                uitablerow [
                                    uihlist $ui_padbutton [
                                        uifill $ui_checksize
                                        uitextleft "Map Effects"
                                        uialign -1 0
                                    ]
                                    uiselect 0.2 0.025 "mapeffects" [
                                        1 "^f0Low"          []
                                        2 "^f2Medium"       []
                                        3 "^f3High"         []
                                    ] [uialign 1 0] "settings_mapeffects"
                                ]
                                uibar 1 0
                                uitablerow [
                                    uihlist $ui_padbutton [
                                        uifill $ui_checksize
                                        uitextleft "Shadow Resolution"
                                        uialign -1 0
                                    ]
                                    uiselect 0.2 0.025 "smsize" [
                                        10 "^f0Very Low"    []
                                        11 "^f0Low"         []
                                        12 "^f2Medium"      []
                                        13 "^f6High"        []
                                        14 "^f3Ultra"       []
                                    ] [uialign 1 0] "settings_smsize"
                                ]
                                uitablerow [
                                    uihlist $ui_padbutton [
                                        uifill $ui_checksize
                                        uitextleft "Shadow Filtering"
                                        uialign -1 0
                                    ]
                                    uiselect 0.2 0.025 "smfilter" [
                                        0 "^f4Off"          []
                                        1 "^f0Low"          []
                                        2 "^f2Medium"       []
                                        3 "^f3High"         []
                                    ] [uialign 1 0] "settings_smfilter"
                                ]
                                uitablerow [
                                    uihlist $ui_padbutton [uicheckbox "Global Illumination" $gi $ui_checksize [gi = (! $gi)]; uialign -1 0]
                                    uiselect 0.2 0.025 "rhtaps" [
                                        12 @(format "%1Low"     (? $gi "^f0" "^f4"))    []
                                        20 @(format "%1Medium"  (? $gi "^f2" "^f4"))    []
                                        32 @(format "%1High"    (? $gi "^f3" "^f4"))    []
                                    ] [uialign 1 0] "settings_rhtaps"
                                ]
                                uitablerow [
                                    uihlist $ui_padbutton [uicheckbox "Ambient Occlusion" $ao $ui_checksize [ao = (! $ao)]; uialign -1 0]
                                    uiselect 0.2 0.025 "aolevel" [
                                        1  @(format "%1Low"     (? $ao "^f0" "^f4"))    []
                                        2  @(format "%1Medium"  (? $ao "^f2" "^f4"))    []
                                        3  @(format "%1High"    (? $ao "^f6" "^f4"))    []
                                        4  @(format "%1Ultra"   (? $ao "^f3" "^f4"))    []
                                    ] [uialign 1 0] "settings_aotaps"
                                ]
                                uitablerow [
                                    uihlist $ui_padbutton [uicheckbox "Volumetric Lighting" $volumetric $ui_checksize [volumetric = (! $volumetric)]; uialign -1 0]
                                    uiselect 0.2 0.025 "vollevel" [
                                        1 @(format "%1Low"     (? $volumetric "^f0" "^f4"))    []
                                        2 @(format "%1Medium"  (? $volumetric "^f2" "^f4"))    []
                                        3 @(format "%1High"    (? $volumetric "^f6" "^f4"))    []
                                        4 @(format "%1Ultra"   (? $volumetric "^f3" "^f4"))    []
                                    ] [uialign 1 0] "settings_volsteps"
                                ]
                                uitablerow [
                                    uihlist $ui_padbutton [
                                        uifill $ui_checksize
                                        uitextleft "Bloom Resolution"
                                        uialign -1 0
                                    ]
                                    uiselect 0.2 0.025 "bloomsize" [
                                        6  "^f0Low"         [bloomiter 0]
                                        9  "^f2Medium"      [bloomiter 0]
                                        10 "^f6High"        [bloomiter 1]
                                        11 "^f3Ultra"       [bloomiter 4]
                                    ] [uialign 1 0] "settings_bloomsize"
                                ]
                                uibar 1 0
                                //Water Settings: Reflections,Caustics, & Animation checkboxes
                                uitablerow [
                                    uivlist 0 [
                                        uihlist $ui_padbutton [
                                            uifill $ui_checksize
                                            uitext "Water"
                                            uialign -1 0
                                        ]
                                        uialign -1 0
                                    ]
                                    uivlist 0 [
                                        uifill 0.2
                                        uivlist $ui_padbutton [
                                            uihlist $ui_padbutton [
                                                uicheckbox "Reflections" $waterreflect $ui_checksize [waterreflect = (! $waterreflect)] [] [] [] [uitooltip "settings_waterreflect"]
                                                uialign -1 0
                                            ]
                                            uihlist $ui_padbutton [
                                                uicheckbox "Caustics" $caustics $ui_checksize [caustics = (! $caustics)] [] [] [] [uitooltip "settings_caustics"]
                                                uialign -1 0
                                            ]
                                            uialign -1 0
                                        ]
                                        uialign 1 0
                                    ]
                                ]

                                uibar 1 0
                                uitablerow [
                                    uihlist $ui_padbutton [
                                        uifill $ui_checksize
                                        uitextleft "Texture Quality"
                                        uialign -1 0
                                    ]
                                    uiselect 0.2 0.025 "texreduce" [
                                        12 "^f0Very Low"    []
                                        6 "^f2Low"          []
                                        3 "^f6Medium"       []
                                        0 "^f3High"         []
                                    ] [uialign 1 0] "settings_texreduce"
                                ]
                                uitablerow [
                                    uihlist $ui_padbutton [
                                        uifill $ui_checksize
                                        uitextleft "Reflection Map Quality"
                                        uialign -1 0
                                    ]
                                    uiselect 0.2 0.025 "envmapsize" [
                                        4 "^f0Low"          []
                                        6 "^f2Medium"       []
                                        8 "^f6High"         []
                                        10 "^f3Ultra"       []
                                    ] [uialign 1 0] "settings_envmapsize"
                                ]

                                uibar 1 0
                                uitablerow [
                                    uihlist $ui_padbutton [
                                        uicheckbox "Soft Particles" $softparticles $ui_checksize [softparticles = (! $softparticles)] [] [] [] [uitooltip "settings_softparticles"]
                                        uialign -1 0
                                    ]
                                ]
                                uitablerow [
                                    uihlist $ui_padbutton [
                                        uicheckbox "Move Particles with Wind" $particlewind $ui_checksize [particlewind = (! $particlewind)] [] [] [] [uitooltip "settings_particlewind"]
                                        uialign -1 0
                                    ]
                                ]
                                uitablerow [
                                    uihlist $ui_padbutton [
                                        uicheckbox "Bloodstains" $stains $ui_checksize [stains = (! $stains)] [] [] [] [uitooltip "settings_stainfade"]
                                        uialign -1 0
                                    ]
                                    uiselect 0.2 0.025 "stainfade" [
                                        2000  @(format "[%1Instant Fade]"    (? $stains "^f0" "^f4"))   [maxstaintris 2048]
                                        15000 @(format "[%1Quick Fade]"      (? $stains "^f2" "^f4"))   [maxstaintris 4096]
                                        30000 @(format "[%1Moderate Fade]"   (? $stains "^f6" "^f4"))   [maxstaintris 8192]
                                        60000 @(format "[%1Slow Fade]"       (? $stains "^f3" "^f4"))   [maxstaintris 8192]
                                    ] [uialign 1 0] "settings_stainfade"
                                ]
                                uitablerow [
                                    uihlist $ui_padbutton [
                                        uicheckbox "Grass" $grass $ui_checksize [grass = (! $grass)] [] [] [] [uitooltip "settings_grassdist"]
                                        uialign -1 0
                                    ]
                                    uiselect 0.2 0.025 "grassdist" [
                                        128     @(format "%1Near"       (? $grass "^f0" "^f4")) []
                                        256     @(format "%1Moderate"   (? $grass "^f2" "^f4")) []
                                        512     @(format "%1Far"        (? $grass "^f6" "^f4")) []
                                        1024    @(format "%1Distant"    (? $grass "^f3" "^f4")) []
                                    ] [uialign 1 0] "settings_grassdist"
                                ]
                            ] 1 [ // Display Tab
                                //Render scale slider
                                uitablerow [
                                    uihlist $ui_padbutton [
                                        uifill $ui_checksize
                                        uitextleft "Render Scale"
                                        uialign -1 0
                                    ]
                                    uihlist $ui_padbutton [
                                        uihorzslider "gscale" 25 100 1 0.2 0.025 [
                                            uivlist 0 [
                                                uifill 0.050 0
                                                uitext (format "^f[%1]%2%%" (rgbtohex @(hsltorgb (*f (- 100 $gscale) 1.6) 1 0.5)) $gscale)
                                                // HSL allows for changing just hue with respect to slider value, is then converted to RGB and then hex.
                                                // Number preceding gscale is the offset, number afterward is the rate of hue change; 100 and 1.6 here respectively.
                                            ]
                                        ] "settings_gscale"
                                        uialign 1 0
                                    ]
                                ]
                                //Fullscreen toggle
                                uitablerow [
                                    uihlist $ui_padbutton [
                                        uicheckbox "Fullscreen" $fullscreen $ui_checksize [fullscreen = (! $fullscreen)] [] [] [] [] "settings_fullscreen"
                                        uialign -1 0
                                    ]
                                ]
                                uibar 1 0
                                //Texture filtering: anisotropic and bi/tri-linear texture filtering
                                uitablerow [
                                    uihlist $ui_padbutton [
                                        uifill $ui_checksize
                                        uitextleft "Anisotropic Filtering"
                                        uialign -1 0
                                    ]
                                    uiselect 0.2 0.025 "aniso" [
                                        0       "^f4Off"    []
                                        2       "^f02x"     []
                                        4       "^f24x"     []
                                        8       "^f68x"     []
                                        16      "^f316x"    []
                                    ] [uialign 1 0] "settings_aniso"
                                ]
                                uitablerow [
                                    uihlist $ui_padbutton [
                                        uifill $ui_checksize
                                        uitextleft "Texture Filtering"
                                        uialign -1 0
                                    ]
                                    uivlist $ui_padbutton [
                                        uifill 0.2 0
                                        uihlist 0 [
                                            uihlist 0 [
                                                uicheckbox "Bilinear" $bilinear $ui_checksize [bilinear = (! $bilinear)] [] [] [] [] "settings_bilinear"
                                                uialign -1 0
                                            ]
                                            uihlist 0 [
                                                uicheckbox "Trilinear" $trilinear $ui_checksize [trilinear = (! $trilinear)] [] [] [] [] "settings_trilinear"
                                                uialign 1 0
                                            ]
                                            uiclamp 1 0
                                        ]
                                        uialign 1 0
                                    ]
                                ]
                                //Various kinds of antialiasing here: morphological, temporal, fast approximate, multisample
                                uibar 1 0
                                uitablerow [
                                    uihlist $ui_padbutton [
                                        uicheckbox "Advanced AA Settings" $advancedaa $ui_checksize [advancedaa = (! $advancedaa)] [] [] [] [] "settings_advancedaa"
                                        uialign -1 0
                                    ]
                                ]
                                if ($advancedaa) [ //advanced aa settings
                                    uitablerow [
                                        uihlist $ui_padbutton [
                                            uicheckbox "Temporal Quincunx AA" $tqaa $ui_checksize [tqaa = (! $tqaa)] [] [] [] [] "settings_tqaa"
                                            uialign -1 0
                                        ]
                                    ]
                                    uitablerow [
                                        uihlist $ui_padbutton [
                                            uicheckbox "Morphological Subpixel AA" $smaa $ui_checksize [smaa = (! $smaa)] [] [] [] [] "settings_smaa"
                                            uialign -1 0
                                        ]
                                        uiselect 0.2 0.025 "smaaquality" [
                                            0   @(format "%1Low"            (? $smaa "^f0" "^f4"))      [smaacoloredge 0]
                                            1   @(format "%1Medium"         (? $smaa "^f2" "^f4"))      [smaacoloredge 0]
                                            2   @(format "%1High"           (? $smaa "^f6" "^f4"))      [smaacoloredge 0]
                                            3   @(format "%1Ultra"          (? $smaa "^f3" "^f4"))      [smaacoloredge 1]
                                        ] [uialign 1 0] "settings_smaa"
                                    ]
                                    uitablerow [
                                        uihlist $ui_padbutton [
                                            uicheckbox "Fast Approximate AA" $fxaa $ui_checksize [fxaa = (! $fxaa)] [] [] [] [] "settings_fxaa"
                                            uialign -1 0
                                        ]
                                        uiselect 0.2 0.025 "fxaaquality" [
                                            0   @(format "%1Low"            (? $fxaa "^f0" "^f4"))    []
                                            1   @(format "%1Medium"         (? $fxaa "^f2" "^f4"))    []
                                            2   @(format "%1High"           (? $fxaa "^f6" "^f4"))    []
                                            3   @(format "%1Ultra"          (? $fxaa "^f3" "^f4"))    []
                                        ] [uialign 1 0] "settings_fxaa"
                                    ]
                                    uitablerow [
                                        uihlist $ui_padbutton [
                                            uifill $ui_checksize
                                            uitextleft "Multisample AA"
                                            uialign -1 0
                                        ]
                                        uiselect 0.2 0.025 "msaa" [
                                            0   "^f4Off"    []
                                            2   "^f02x"     []
                                            4   "^f24x"     []
                                            8   "^f68x"     []
                                            16  "^f316x"    []
                                        ] [uialign 1 0] "settings_msaa"
                                    ]
                                ] [ //standard aa settings
                                    uitablerow [
                                        uihlist $ui_padbutton [
                                            uifill $ui_checksize
                                            uitextleft "AA Level"
                                            uialign -1 0
                                        ]
                                        uiselect 0.2 0.025 "aalevel" [
                                            1   "^f4Off"      []
                                            2   "^f0Very Low" []
                                            3   "^f0Low"      []
                                            4   "^f2Medium"   []
                                            5   "^f6High"     []
                                            6   "^f3Ultra"    []
                                        ] [uialign 1 0] "settings_aalevel"
                                    ]
                                ]
                                uibar 1 0
                                uitablerow [
                                    uihlist $ui_padbutton [
                                        uifill $ui_checksize
                                        uitextleft "Gamma"
                                        uialign -1 0
                                    ]
                                    uihlist $ui_padbutton [
                                        uihorzslider "gamma" 30 170 1 0.2 0.025 [
                                            uivlist 0 [
                                                uifill 0.050 0
                                                uitext $gamma
                                            ]
                                        ] "settings_gamma"
                                        uialign 1 0
                                    ]
                                ]
                                uitablerow [
                                    uihlist $ui_padbutton [
                                        uifill $ui_checksize
                                        uitextleft "Framerate Cap"
                                        uialign -1 0
                                    ]
                                    uihlist $ui_padbutton [
                                        uihorzslider "maxfps" 5 200 1 0.2 0.025 [
                                            uivlist 0 [
                                                uifill 0.050 0
                                                uitext $maxfps
                                            ]
                                        ] "settings_maxfps"
                                        uialign 1 0
                                    ]
                                ]
                                uitablerow [
                                    uihlist $ui_padbutton [
                                        uicheckbox "Vertical Sync" $vsync $ui_checksize [vsync = (! $vsync)] [] [] [] [] "settings_vsync"
                                        uialign -1 0
                                    ]
                                ]

                            ] 2 [ // Audio Tab
                                uitablerow [
                                    uihlist $ui_padbutton [
                                        uifill $ui_checksize
                                        uitextleft "Master Volume"
                                        uialign -1 0
                                    ]
                                    uihlist $ui_padbutton [
                                        uihorzslider "mastervol" 0 255 1 0.2 0.025 [
                                            uivlist 0 [
                                                uifill 0.050 0
                                                uitext (format "%1%%" (toint (*f (divf $mastervol 255) 100)))
                                            ]
                                        ] "settings_mastervol"
                                        uialign 1 0
                                    ]
                                ]
                                uitablerow [
                                    uihlist $ui_padbutton [
                                        uifill $ui_checksize
                                        uitextleft "Game Volume"
                                        uialign -1 0
                                    ]
                                    uihlist $ui_padbutton [
                                        uihorzslider "soundvol" 0 255 1 0.2 0.025 [
                                            uivlist 0 [
                                                uifill 0.050 0
                                                uitext (format "%1%%" (toint (*f (divf $soundvol 255) 100)))
                                            ]
                                        ] "settings_soundvol"
                                        uialign 1 0
                                    ]
                                ]
                                uitablerow [
                                    uihlist $ui_padbutton [
                                        uifill $ui_checksize
                                        uitextleft "Music Volume"
                                        uialign -1 0
                                    ]
                                    uihlist $ui_padbutton [
                                        uihorzslider "musicvol" 0 255 1 0.2 0.025 [
                                            uivlist 0 [
                                                uifill 0.050 0
                                                uitext (format "%1%%" (toint (*f (divf $musicvol 255) 100)))
                                            ]
                                        ] "settings_musicvol"
                                        uialign 1 0
                                    ]
                                ]
                                uibar 1 0
                                uitablerow [
                                    uihlist $ui_padbutton [
                                        uifill $ui_checksize
                                        uitextleft "Map Music"
                                        uialign -1 0
                                    ]
                                    uiselect 0.2 0.025 "musictype" [
                                        0   "Off"             []
                                        3   "By Map"          []//note that option 3 is used here because musictype 1 seems to shuffle (?)
                                        2   "Random/Loop"     []
                                        5   "Random/Shuffle"  []
                                    ] [uialign 1 0] "settings_musictype"
                                ]

                            ] 3 [ // Gameplay Tab
                                uitablerow [
                                    uihlist $ui_padbutton [
                                        uifill $ui_checksize
                                        uitextleft "Player Model Brightness"
                                        uialign -1 0
                                    ]
                                    uihlist $ui_padbutton [
                                        uihorzslider "fullbrightmodels" 0 200 1 0.2 0.025 [
                                            uivlist 0 [
                                                uifill 0.050 0
                                                uitext (format "%1%%" (toint (+f (divf $fullbrightmodels 2) 100)))
                                            ]
                                        ] "settings_fullbrightmodels"
                                        uialign 1 0
                                    ]

                                ]
                                uitablerow [
                                    uihlist $ui_padbutton [
                                        uifill $ui_checksize
                                        uitextleft "Race Mode Player Opacity"
                                        uialign -1 0
                                    ]
                                    uihlist $ui_padbutton [
                                        uihorzslider "playerghostblend" 0 1 .125 0.2 0.025 [
                                            uivlist 0 [
                                                uifill 0.050 0
                                                uitext (format "%1%%" (toint (*f $playerghostblend 100)))
                                            ]
                                        ] "settings_playerghostblend"
                                        uialign 1 0
                                    ]

                                ]
                                uibar 1 0
                                uitablerow [
                                    uihlist $ui_padbutton [
                                        uifill $ui_checksize
                                        uitextleft "First Person FOV"
                                        uialign -1 0
                                    ]
                                    uihlist $ui_padbutton [
                                        uihorzslider "firstpersonfov" 90 150 1 0.2 0.025 [
                                            uivlist 0 [
                                                uifill 0.050 0
                                                uitext $firstpersonfov
                                            ]
                                        ] "settings_firstpersonfov"
                                        uialign 1 0
                                    ]
                                ]
                                uitablerow [
                                    uihlist $ui_padbutton [
                                        uifill $ui_checksize
                                        uitextleft "Third Person FOV"
                                        uialign -1 0
                                    ]
                                    uihlist $ui_padbutton [
                                        uihorzslider "thirdpersonfov" 90 150 1 0.2 0.025 [
                                            uivlist 0 [
                                                uifill 0.050 0
                                                uitext $thirdpersonfov
                                            ]
                                        ] "settings_thirdpersonfov"
                                        uialign 1 0
                                    ]
                                ]
                                uitablerow [
                                    uihlist $ui_padbutton [
                                        uifill $ui_checksize
                                        uitextleft "Spectator FOV"
                                        uialign -1 0
                                    ]
                                    uihlist $ui_padbutton [
                                        uihorzslider "specfov" 90 150 1 0.2 0.025 [
                                            uivlist 0 [
                                                uifill 0.050 0
                                                uitext $specfov
                                            ]
                                        ] "settings_specfov"
                                        uialign 1 0
                                    ]
                                ]
                                uitablerow [
                                    uihlist $ui_padbutton [
                                        uifill $ui_checksize
                                        uitextleft "Editing FOV"
                                        uialign -1 0
                                    ]
                                    uihlist $ui_padbutton [
                                        uihorzslider "editfov" 90 150 1 0.2 0.025 [
                                            uivlist 0 [
                                                uifill 0.050 0
                                                uitext $editfov
                                            ]
                                        ] "settings_editfov"
                                        uialign 1 0
                                    ]
                                ]
                                uibar 1 0
                                uitablerow [
                                    uihlist $ui_padbutton [
                                        uifill $ui_checksize
                                        uitextleft "Auto Weapon Reloading"
                                        uialign -1 0
                                    ]
                                    uiselect 0.2 0.025 "weapautoreload" [
                                        0   "Off"              []
                                        1   "When Empty Only"  []
                                        2   "Stepwise Weaps" []
                                        3   "When Unscoped"    []
                                        4   "Always"
                                    ] [uialign 1 0] "settings_weapautoreload"
                                ]
                                uitablerow [
                                    uihlist $ui_padbutton [
                                        uicheckbox "Auto Switch Empty Weapon" $weapautoswitch $ui_checksize [weapautoswitch = (! $weapautoswitch)] [] [] [] [] "settings_weapautoswitch"
                                        uialign -1 0
                                    ]
                                ]
                                uibar 1 0
                                uitablerow [
                                    uihlist $ui_padbutton [
                                        uicheckbox "First Person Bob" $firstpersonbob $ui_checksize [firstpersonbob = (! $firstpersonbob)] [] [] [] [] "settings_firstpersonbob"
                                        uialign -1 0
                                    ]
                                ]
                                uitablerow [
                                    uihlist $ui_padbutton [
                                        uicheckbox "First Person Sway" $firstpersonsway $ui_checksize [firstpersonsway = (! $firstpersonsway)] [] [] [] [] "settings_firstpersonsway"
                                        uialign -1 0
                                    ]
                                ]

                            ] 4 [ // Controls Tab
                                uitablerow [
                                    uihlist $ui_padbutton [
                                        uifill $ui_checksize
                                        uitextleft "Camera Sensitivity"
                                        uialign -1 0
                                    ]
                                    uihlist $ui_padbutton [
                                        uihorzslider "sensitivity" 1 50 1 $ui_buttonzw $ui_buttonzh [
                                            uivlist 0 [
                                                uifill 0.050 0
                                                uitext $sensitivity
                                            ]
                                        ] "settings_sensitivity"
                                        uialign 1 0
                                    ]
                                ]
                                uitablerow [
                                    uihlist $ui_padbutton [
                                        uifill $ui_checksize
                                        uitextleft "Cursor Sensitivity"
                                        uialign -1 0
                                    ]
                                    uihlist $ui_padbutton [
                                        uihorzslider "mousesensitivity" 1 50 1 $ui_buttonzw $ui_buttonzh [
                                            uivlist 0 [
                                                uifill 0.050 0
                                                uitext $mousesensitivity
                                            ]
                                        ] "settings_mousesensitivity"
                                        uialign 1 0
                                    ]
                                ]
                                uitablerow [
                                    uihlist $ui_padbutton [
                                        uifill $ui_checksize
                                        uitextleft "Zoom Sensitivity Multiplier"
                                        uialign -1 0
                                    ]
                                    uihlist $ui_padbutton [
                                        uihorzslider "zoomsensitivity" 0 5 .02 $ui_buttonzw $ui_buttonzh [
                                            uivlist 0 [
                                                uifill 0.050 0
                                                uitext $zoomsensitivity
                                            ]
                                        ] "settings_zoomsensitivity"
                                        uialign 1 0
                                    ]
                                ]
                                uitablerow [
                                    uihlist $ui_padbutton [
                                      uicheckbox "Invert Mouse Y-Axis" $mouseinvert $ui_checksize [mouseinvert = (! $mouseinvert)] [] [] [] [] "settings_mouseinvert"
                                      uialign -1 0
                                    ]
                                ]
                                uitablerow [
                                    uifill 0 0
                                    uihlist $ui_padbutton [
                                        uichecktextbutton "Customize Keybinds" "" 0 $ui_buttonzw $ui_buttonzh [
                                            uiopen binds
                                        ] $colourwhite $ui_default [] "settings_keybinds"
                                      uialign 1 0
                                    ]
                                ]

                            ] 5 [ // User Interface Tab
                                uitablerow [
                                    uihlist $ui_padbutton [
                                        uifill $ui_checksize
                                        uitextleft "Show FPS"
                                        uialign -1 0
                                    ]
                                    uiselect 0.2 0.025 "showfps" [
                                        0 "^f4Off"              []
                                        1 "^f7Avg Only"         []
                                        2 "^f7Avg & +Max-Min"   []
                                        3 "^f7Avg & Range"      []
                                        4 "^f7Avg & Frametime"  []
                                    ] [uialign 1 0] "settings_showfps"
                                ]
                                uitablerow [
                                    uihlist $ui_padbutton [
                                        uifill $ui_checksize
                                        uitextleft "Show Map Stats"
                                        uialign -1 0
                                    ]
                                    uiselect 0.2 0.025 "showstats" [
                                        0 "^f4Off"          []
                                        1 "^f7Edit Only"    []
                                        2 "^f7Always"       []
                                    ] [uialign 1 0] "settings_showstats"
                                ]
                                uitablerow [
                                    uihlist $ui_padbutton [
                                        uifill $ui_checksize
                                        uitextleft "Time Display Style"
                                        uialign -1 0
                                    ]
                                    uiselect 0.2 0.025 "showtimestyle" [
                                        0 "^f7724.5s"      []
                                        1 "^f712:34.567"   []
                                        2 "^f712:34.5"     []
                                        3 "^f712:34"       []
                                        4 "^f712m34s"      []
                                    ] [uialign 1 0] "settings_showtimestyle"
                                ]
                                uitablerow [
                                    uihlist $ui_padbutton [
                                        uifill $ui_checksize
                                        uitextleft "Crosshair Display Style"
                                        uialign -1 0
                                    ]
                                    uiselect 0.2 0.025 "crosshairweapons" [
                                        0 "Same for All"     []
                                        1 "By Weapon"        []
                                        2 "By Weap+Colour"   []
                                    ] [uialign 1 0] "settings_crosshairweapons"
                                ]
                                uitablerow [
                                    uihlist $ui_padbutton [
                                      uicheckbox "Show Real Time" $showrealtime $ui_checksize [showrealtime = (! $showrealtime)] [] [] [] [] "settings_showrealtime"
                                      uialign -1 0
                                    ]
                                ]
                                uitablerow [
                                    uihlist $ui_padbutton [
                                      uicheckbox "Show HUD" $showhud $ui_checksize [showhud = (! $showhud)] [] [] [] [] "settings_showhud"
                                      uialign -1 0
                                    ]
                                ]
                                uitablerow [
                                    uihlist $ui_padbutton [
                                      uicheckbox "Show Minimap" $showminimap $ui_checksize [showminimap = (! $showminimap)] [] [] [] [] "settings_showminimap"
                                      uialign -1 0
                                    ]
                                ]
                                uitablerow [
                                    uihlist $ui_padbutton [
                                      uicheckbox "Show Moves Remaining" $showmovecount $ui_checksize [showmovecount = (! $showmovecount)] [] [] [] [] "settings_showmovecount"
                                      uialign -1 0
                                    ]
                                ]
                                uitablerow [
                                    uihlist $ui_padbutton [
                                      uicheckbox "Show Weight" $showweight $ui_checksize [showweight = (! $showweight)] [] [] [] [] "settings_showweight"
                                      uialign -1 0
                                    ]
                                ]
                                uitablerow [
                                    uihlist $ui_padbutton [
                                      uicheckbox "Show Speed" $showvelocity $ui_checksize [showvelocity = (! $showvelocity)] [] [] [] [] "settings_showvelocity"
                                      uialign -1 0
                                    ]
                                ]
                                uitablerow [
                                    uihlist $ui_padbutton [
                                      uicheckbox "Show Engine Timings" $timer $ui_checksize [timer = (! $timer)] [] [] [] [] "settings_timer"
                                      uialign -1 0
                                    ]
                                ]

                            ] 6 [ //Autoexec Tab
                                uitablerow [
                                    uitext "Not implemented yet. ^nCheck again later!"
                                ]
                            ]
                        ]
                    ]
                ]
            ]
            uihlist 0 [uivscroll $ui_slidersize 0.4 3; uialign 1 0; uiclamp 0 1]
        ]
    ]
] [] [if (pendingchanges) [showui "changes"]] //for settings that require a refresh: MSAA, texreduce, anisotropic, etc

//ui for selecting keyboard layout to display in binds menu
uimenu "keyboard" "Select Keyboard" "textures/keys/a" [
    uivlist $ui_padsmall [
        uichecktextbutton "ANSI QWERTY (US)" "" 0 $ui_buttonw $ui_buttonh [
                keyboardlayout "pc104"
                uiclose "keyboard"
            ] $colourwhite $ui_default
        uichecktextbutton "ANSI Dvorak (US)" "" 0 $ui_buttonw $ui_buttonh [
                keyboardlayout "dvorak"
                uiclose "keyboard"
            ] $colourwhite $ui_default
    ]
] [] [showui "binds"]

//ui for changing keybinds
//for documentation on how to add keyboards to this ui, see keyboards.cfg
uimenu "binds" "Key Binds" "textures/icons/settings" [
    uivlist $ui_padsmall [
        uichecktextbutton "Select Layout" "" 0 $ui_buttonw $ui_buttonh [ //button for changing layout
            uiopen "keyboard"
        ] $colourwhite $ui_default
        uibar 1 0
        uihlist $ui_padsmall [ //keyboard rendering
            uivlist $ui_padsmall [
                loop j $ui_binds_@[keyboardlayout]_rows [ //loops through keyboard rows
                    uihlist $ui_padsmall [ //hlist since the keyboard config is defined in rows
                        loop i (listlen $[ui_binds_@[keyboardlayout]_@j]) [ //loop through items in each configured row list
                            ui_binds_temp_key = (sublist $[ui_binds_@[keyboardlayout]_@j] $i 1)
                            //key rendering
                            if (& (!=s "_" $ui_binds_temp_key) (!=s "." $ui_binds_temp_key) ) [// "_" and "." are spacers;if found, do not attempt to uiimage and instead uifill 1 key width
                                if (< (strlen $ui_binds_temp_key) 3) [ //if the key is short (length <3 {includes alphanumeric chars}, it can automatically be rendered at normal size without checking (layouts with nonstandard alphanumeric keys will require this to be changed or omitted)
                                    uiimgbutton (concatword "<grey>textures/keys/" $ui_binds_temp_key) $ui_checksize $ui_checksize [
                                        ui_binds_current_key = $ui_binds_temp_key //once a key is selected, change the bind vars to match selected key
                                        ui_binds_entry_normal = (getbind $ui_binds_current_key)
                                        ui_binds_entry_edit = (geteditbind $ui_binds_current_key)
                                        ui_binds_entry_spectator = (getspecbind $ui_binds_current_key)
                                        ui_binds_entry_wait = (getwaitbind $ui_binds_current_key)
                                    ] [] [] [] 0 [] "0xffffff" [] 1
                                ] [
                                    if (!= -1 (listfind k $ui_binds_@[keyboardlayout]_largekeys [=s $k $ui_binds_temp_key ] ) ) [ //if the key is found to be long make it larger
                                        l = (listfind k $ui_binds_@[keyboardlayout]_largekeys [=s $k $ui_binds_temp_key ] )
                                        uiimgbutton (concatword "<grey>textures/keys/" $ui_binds_temp_key) ( *f (sublist $ui_binds_@[keyboardlayout]_keyscale $l 1) $ui_checksize) $ui_checksize [
                                            ui_binds_current_key = $ui_binds_temp_key //once a key is selected, change the bind vars to match selected key
                                            ui_binds_entry_normal = (getbind $ui_binds_current_key)
                                            ui_binds_entry_edit = (geteditbind $ui_binds_current_key)
                                            ui_binds_entry_spectator = (getspecbind $ui_binds_current_key)
                                            ui_binds_entry_wait = (getwaitbind $ui_binds_current_key)
                                        ] [] [] [] 0 [] "0xffffff" [] 1
                                    ] [ //else display standard size
                                        uiimgbutton (concatword "<grey>textures/keys/" $ui_binds_temp_key) $ui_checksize $ui_checksize [
                                            ui_binds_current_key = $ui_binds_temp_key //once a key is selected, change the bind vars to match selected key
                                            ui_binds_entry_normal = (getbind $ui_binds_current_key)
                                            ui_binds_entry_edit = (geteditbind $ui_binds_current_key)
                                            ui_binds_entry_spectator = (getspecbind $ui_binds_current_key)
                                            ui_binds_entry_wait = (getwaitbind $ui_binds_current_key)
                                        ] [] [] [] 0 [] "0xffffff" [] 1 //else just display at standard size
                                    ]
                                ]
                            ] [ //else fill in with the appropriate space
                                if (=s "_" (sublist $[ui_binds_@[keyboardlayout]_@j] $i 1)) [ //if "_", insert a full space
                                    uifill $ui_checksize $ui_checksize
                                ] [ //else insert a half space
                                    uifill (divf $ui_checksize 2) $ui_checksize
                                ]
                            ]
                        ]
                    ]
                ]
            ]
            uivlist $ui_padsmall [ //column for numpad vertical keys
                loop i (listlen $[ui_binds_@[keyboardlayout]_vert]) [
                    ui_binds_temp_key = (sublist $ui_binds_@[keyboardlayout]_vert $i 1)
                    if (& (!=s "_" $ui_binds_temp_key) (!=s "." $ui_binds_temp_key) ) [ // "_" and "." are spacers; does not attempt to uiimage and instead uifill 1 key width (for "_") and 1/2 key width (for ".")
                        if (!= -1 (listfind k $ui_binds_@[keyboardlayout]_largekeys [=s $k $ui_binds_temp_key ] ) ) [ //if the key is found to be long make it larger
                            l = (listfind k $ui_binds_@[keyboardlayout]_largekeys [=s $k $ui_binds_temp_key ] )
                            uiimgbutton (concatword "<grey>textures/keys/" $ui_binds_temp_key) $ui_checksize ( *f (sublist $ui_binds_@[keyboardlayout]_keyscale $l 1) $ui_checksize) [
                                ui_binds_current_key = $ui_binds_temp_key //once a key is selected, change the bind vars to match selected key
                                    ui_binds_entry_normal = (getbind $ui_binds_current_key)
                                    ui_binds_entry_edit = (geteditbind $ui_binds_current_key)
                                    ui_binds_entry_spectator = (getspecbind $ui_binds_current_key)
                                    ui_binds_entry_wait = (getwaitbind $ui_binds_current_key)
                            ] [] [] [] 0 [] "0xffffff" [] 1
                        ] [ //else display standard size
                            uiimgbutton (concatword "<grey>textures/keys/" $ui_binds_temp_key) $ui_checksize $ui_checksize [
                                ui_binds_current_key = $ui_binds_temp_key //once a key is selected, change the bind vars to match selected key
                                ui_binds_entry_normal = (getbind $ui_binds_current_key)
                                ui_binds_entry_edit = (geteditbind $ui_binds_current_key)
                                ui_binds_entry_spectator = (getspecbind $ui_binds_current_key)
                                ui_binds_entry_wait = (getwaitbind $ui_binds_current_key)
                            ] [] [] [] 0 [] "0xffffff" [] 1 //else just display at standard size
                        ]
                    ] [ //else fill in with the appropriate space
                        if (=s "_" (sublist $ui_binds_@[keyboardlayout]_vert $i 1)) [ //if "_", insert a full space
                            uifill $ui_checksize $ui_checksize
                        ] [ //else insert a half-space
                            uifill (divf $ui_checksize 2) $ui_checksize
                        ]
                    ]
                ]
            ]
        ]
        uibar 1 0
        uitext (concat "This is the" $ui_binds_current_key "key")
        uibar 1 0
        uihlist $ui_padsmall [
            uivlist $ui_padsmaller [
                uitext "Set Normal Bind"
                uitext "Set Editing Bind"
                uitext "Set Spectator Bind"
                uitext "Set Wait Bind"
            ]
            uivlist $ui_padsmaller [ //thirty-six character entry fields for each type of bind (normal, edit, spectator)
                uiinput "ui_binds_entry_normal" 36 [bind $ui_binds_current_key $ui_binds_entry_normal] 1 0 []
                uiinput "ui_binds_entry_edit" 36 [editbind $ui_binds_current_key $ui_binds_entry_edit] 1 0 []
                uiinput "ui_binds_entry_spectator" 36 [specbind $ui_binds_current_key $ui_binds_entry_spectator] 1 0 []
                uiinput "ui_binds_entry_wait" 36 [waitbind $ui_binds_current_key $ui_binds_entry_wait] 1 0 []
            ]
        ]
    ]
    uialign -1 0
]
